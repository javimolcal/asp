---
title: "Resultats de l'Enquesta de Factors de Risc a l’Escola Secundària i de l'Enquesta
  de Salut de Barcelona sobre qüestions relacionades amb l'alimentació"
author: "Javi Molero"
date: "29/6/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# {.tabset}

## Enquesta de Factors de Risc a l’Escola Secundària {.tabset}

### Característiques sociodemogràfiques

```{r debug, include=FALSE}
#install.packages("flextable")
library(rmarkdown)
library(haven)
library(haven)
library(dplyr)
library(tidyverse)
library(summarytools)
library(pastecs)
library(crosstable)
library(expss)
library(gtsummary)
library(tidyverse)
library(flextable)
library(officer)
library(naniar)
library(flextable)

fresc_21 <- read_dta("//aspblfs/usuaris$/ext_jmolero/Escritorio/Alimentació BCN/FRESC/BBDD_FRESC2021.dta")

fresc_21 <- filter(fresc_21, CURS_3 != 5)

fresc_21$fet_dieta <- fresc_21$fet_dieta %>% 
  as.character(fresc_21$fet_dieta) 

fresc_21$fent_dieta <- fresc_21$fent_dieta %>% 
  as.character(fresc_21$fent_dieta)

fresc_21$dieta <- paste0(fresc_21$fet_dieta, fresc_21$fent_dieta)

fresc_21 <- fresc_21 %>%
  mutate(dieta = case_when(dieta=="11" ~ "Està fent dieta",
                           dieta=="12" ~ "Ha fet dieta alguna vegada",
                           dieta=="2NA" ~ "Mai ha fet dieta")) %>% 
  replace_with_na(replace = list(dieta = "NANA"))

fresc_21 <- fresc_21 %>%
  replace_with_na(replace = list(gana_r = 9))

fresc_21 <- fresc_21 %>%
  replace_with_na(replace = list(districte_al = 99))

fresc_21 <- fresc_21 %>%
  replace_with_na(replace = list(pnaix_alumne = 99))
```

```{r sociodem, echo=FALSE}
taula_fresc_sociodem <- fresc_21 %>%
  mutate(sexe = case_when(sexe== 1 ~ "Dona", sexe== 2 ~ "Home")) %>%
  mutate(districte_al = case_when(districte_al== 1 ~ "Ciutat Vella",
                                  districte_al== 2 ~ "Eixample",
                                  districte_al== 3 ~ "Sants-Montuïc",
                                  districte_al== 4 ~ "Les Corts",
                                  districte_al== 5 ~ "Sarrià-Sant Gervasi",
                                  districte_al== 6 ~ "Gràcia",
                                  districte_al== 7 ~ "Horta-Guinardó",
                                  districte_al== 8 ~ "Nou Barris",
                                  districte_al== 9 ~ "Sant Andreu",
                                  districte_al== 10 ~ "Sant Martí",
                                  districte_al== 11 ~ "Fora de Barcelona",)) %>%
  mutate(districte_al = factor(districte_al, levels = c("Ciutat Vella",
                                                        "Eixample",
                                                        "Sants-Montuïc",
                                                        "Les Corts",
                                                        "Sarrià-Sant Gervasi",
                                                        "Gràcia",
                                                        "Horta-Guinardó",
                                                        "Nou Barris",
                                                        "Sant Andreu",
                                                        "Sant Martí",
                                                        "Fora de Barcelona"))) %>%
  mutate(CURS_3 = case_when(CURS_3== 1 ~ "2n d'ESO", CURS_3== 2 ~ "4t d'ESO",
                            CURS_3== 3 ~ "2n de Batx", CURS_3== 4 ~ "2n CFGM")) %>%
  mutate(CURS_3 = factor(CURS_3, levels = c("2n d'ESO",
                                            "4t d'ESO",
                                            "2n de Batx",
                                            "2n CFGM"))) %>%
  mutate(FAS_cat = case_when(FAS_cat== 1 ~ "Baix", FAS_cat== 2 ~ "Mig",
                             FAS_cat== 3 ~ "Alt")) %>%
  mutate(FAS_cat = factor(FAS_cat, levels = c("Baix",
                                              "Mig",
                                              "Alt"))) %>% 
  mutate(pnaix_alumne = case_when(pnaix_alumne== 1 ~ "A Barcelona",
                                  pnaix_alumne== 2 ~ "A un altre municipi de Catalunya",
                                  pnaix_alumne== 3 ~ "A un altre municipi d'Espanya, fora de Catalunya",
                                  pnaix_alumne== 4 ~ "A l'estranger")) %>%
  mutate(pnaix_alumne = factor(pnaix_alumne, levels = c("A Barcelona",
                                                        "A un altre municipi de Catalunya",
                                                        "A un altre municipi d'Espanya, fora de Catalunya",
                                                        "A l'estranger"))) %>% 
  select(sexe, districte_al, CURS_3, FAS_cat, pnaix_alumne) %>%
  tbl_summary(percent="column",
              statistic = list(all_continuous() ~ "{mean} ({sd})",        
                               all_categorical() ~ "{n} ({p}%)"),
              label  = list(sexe ~ "Sexe",
                            districte_al ~ "Districte",
                            CURS_3 ~ "Curs",
                            FAS_cat ~ "Nivell socioeconòmic²",
                            pnaix_alumne ~ "Lloc de naixement"),
              missing_text = "Desconegut"
  ) %>% 
  #add_n() %>% 
  #add_p() %>%
  #add_overall() %>% 
  italicize_levels() %>% 
  #bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

#print(taula_fresc_sociodem)


flextable_fresc_sociodem <- as_flex_table(taula_fresc_sociodem) %>% 
  autofit() %>% 
  bold(i = 1, j = 1:2, part = "header") %>% 
  footnote(i = 1, j = 2, ref_symbols = c(""), value = as_paragraph("²Hartley JE, Levin K, Currie C. A new version of the HBSC Family Affluence Scale - FAS III: Scottish Qualitative Findings from the International FAS Development Study. Child Indic Res. 2016;9:233-245. doi: 10.1007/s12187-015-9325-3. Epub 2015 Aug 2. PMID: 26925177; PMCID: PMC4757604.")) 

flextable_fresc_sociodem
```

### Total

```{r general, echo=FALSE}
taula_fresc <- fresc_21 %>%
  mutate(fruita = case_when(fruita== 1 ~ "Mai",
                            fruita== 2 ~ "3 o menys vegades a la setmana",
                            fruita== 3 ~ "3 o menys vegades a la setmana",
                            fruita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                            fruita== 5 ~ "1 o 2 vegades al dia",
                            fruita== 6 ~ "1 o 2 vegades al dia",
                            fruita== 7 ~ "3 o més vegades al dia")) %>%
  mutate(fruita = factor(fruita, levels = c("Mai",
                                            "3 o menys vegades a la setmana",
                                            "Entre 4 i 6 vegades a la setmana",
                                            "1 o 2 vegades al dia",
                                            "3 o més vegades al dia"))) %>%
  mutate(verd_crua = case_when(verd_crua== 1 ~ "Mai",
                               verd_crua== 2 ~ "3 o menys vegades a la setmana",
                               verd_crua== 3 ~ "3 o menys vegades a la setmana",
                               verd_crua== 4 ~ "Entre 4 i 6 vegades a la setmana",
                               verd_crua== 5 ~ "1 o 2 vegades al dia",
                               verd_crua== 6 ~ "1 o 2 vegades al dia",
                               verd_crua== 7 ~ "3 o més vegades al dia")) %>%
  mutate(verd_crua = factor(verd_crua, levels = c("Mai",
                                                  "3 o menys vegades a la setmana",
                                                  "Entre 4 i 6 vegades a la setmana",
                                                  "1 o 2 vegades al dia",
                                                  "3 o més vegades al dia"))) %>%
  mutate(verd_cuita = case_when(verd_cuita== 1 ~ "Mai",
                                verd_cuita== 2 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 3 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                                verd_cuita== 5 ~ "1 o 2 vegades al dia",
                                verd_cuita== 6 ~ "1 o 2 vegades al dia",
                                verd_cuita== 7 ~ "3 o més vegades al dia")) %>%
  mutate(verd_cuita = factor(verd_cuita, levels = c("Mai",
                                                    "3 o menys vegades a la setmana",
                                                    "Entre 4 i 6 vegades a la setmana",
                                                    "1 o 2 vegades al dia",
                                                    "3 o més vegades al dia"))) %>%
  mutate(carn_verm = case_when(carn_verm== 1 ~ "Mai",
                               carn_verm== 2 ~ "3 o menys vegades al mes",
                               carn_verm== 3 ~ "3 o menys vegades al mes",
                               carn_verm== 4 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 5 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 6 ~ "Entre 3 i 6 vegades a la setmana",
                               carn_verm== 7 ~ "1 o més vegades al dia")) %>%
  mutate(carn_verm = factor(carn_verm, levels = c("Mai",
                                                  "3 o menys vegades al mes",
                                                  "1 o 2 vegades a la setmana",
                                                  "Entre 3 i 6 vegades a la setmana",
                                                  "1 o més vegades al dia"))) %>%
  mutate(refresc = case_when(refresc== 1 ~ "Mai",
                             refresc== 2 ~ "Entre 1 i 3 vegades al mes",
                             refresc== 3 ~ "Entre 1 i 3 vegades a la setmana",
                             refresc== 4 ~ "Entre 4 i 6 vegades a la setmana",
                             refresc== 5 ~ "1 vegada al dia",
                             refresc== 6 ~ "2 o més vegades al dia",
                             refresc== 7 ~ "2 o més vegades al dia")) %>%
  mutate(refresc = factor(refresc, levels = c("Mai",
                                              "Entre 1 i 3 vegades al mes",
                                              "Entre 1 i 3 vegades a la setmana",
                                              "Entre 4 i 6 vegades a la setmana",
                                              "1 vegada al dia",
                                              "2 o més vegades al dia"))) %>%
  mutate(menj_rapid = case_when(menj_rapid== 1 ~ "Mai",
                                menj_rapid== 2 ~ "1 vegada al mes",
                                menj_rapid== 3 ~ "2 o 3 vegades al mes",
                                menj_rapid== 4 ~ "1 o més vegades a la setmana")) %>%
  mutate(menj_rapid = factor(menj_rapid, levels = c("Mai",
                                                    "1 vegada al mes",
                                                    "2 o 3 vegades al mes",
                                                    "1 o més vegades a la setmana"))) %>%
  mutate(esm_sort = case_when(esm_sort== 1 ~ "Cap vegada",
                              esm_sort== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              esm_sort== 3 ~ "Cada dia",
                              esm_sort== 4 ~ "No pertinent (no surt de casa)")) %>%
  mutate(esm_sort = factor(esm_sort, levels = c("Cap vegada",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Cada dia",
                                                "No pertinent (no surt de casa)"))) %>%
  mutate(pant_sopar = case_when(pant_sopar== 1 ~ "Mai o gairebé mai",
                                pant_sopar== 2 ~ "A vegades",
                                pant_sopar== 3 ~ "Sempre o gairebé sempre")) %>%
  mutate(pant_sopar = factor(pant_sopar, levels = c("Mai o gairebé mai",
                                                    "A vegades",
                                                    "Sempre o gairebé sempre"))) %>%
  mutate(gana_r = case_when(gana_r== 3 ~ "Mai o gairebé mai",
                            gana_r== 2 ~ "A vegades",
                            gana_r== 1 ~ "Sempre o gairebé sempre")) %>%
  mutate(gana_r = factor(gana_r, levels = c("Mai o gairebé mai",
                                            "A vegades",
                                            "Sempre o gairebé sempre"))) %>%
  select(verd_crua, verd_cuita, fruita, carn_verm, refresc, menj_rapid,
         esm_sort, dieta, pant_sopar, gana_r) %>%
  tbl_summary(percent="column",
              statistic = list(all_continuous() ~ "{mean} ({sd})",        
                               all_categorical() ~ "{n} ({p}%)"),
              label  = list(verd_crua ~ "Verdura crua",
                            verd_cuita ~ "Verdura cuita",
                            fruita ~ "Fruita",
                            carn_verm ~ "Carn vermella",
                            refresc ~ "Begudes ensucrades",
                            menj_rapid ~ "Menjar ràpid",
                            esm_sort ~ "Esmorzar abans de sortir de casa",
                            dieta ~ "Dieta per aprimar-se",
                            pant_sopar ~ "Utilització de pantalles durant el sopar",
                            gana_r ~ "Ha anat al llit amb gana per falta de menjar a casa"),
              missing_text = "Desconegut"
  ) %>% 
  #add_n() %>% 
  #add_p() %>%
  #add_overall() %>% 
  italicize_levels() %>% 
  #bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_fresc <- as_flex_table(taula_fresc) %>% 
  autofit() %>% 
  bold(i = 1, j = 1:2, part = "header")

flextable_fresc
```

### Per sexe

```{r sexe, echo=FALSE}
taula_fresc_sexe <- fresc_21 %>%
  mutate(sexe = case_when(sexe== 1 ~ "Dona", sexe== 2 ~ "Home")) %>%
  mutate(fruita = case_when(fruita== 1 ~ "Mai",
                            fruita== 2 ~ "3 o menys vegades a la setmana",
                            fruita== 3 ~ "3 o menys vegades a la setmana",
                            fruita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                            fruita== 5 ~ "1 o 2 vegades al dia",
                            fruita== 6 ~ "1 o 2 vegades al dia",
                            fruita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(fruita = factor(fruita, levels = c("Mai",
                                            "3 o menys vegades a la setmana",
                                            "Entre 4 i 6 vegades a la setmana",
                                            "1 o 2 vegades al dia",
                                            "3 o més vegades al dia"))) %>%
  mutate(verd_crua = case_when(verd_crua== 1 ~ "Mai",
                            verd_crua== 2 ~ "3 o menys vegades a la setmana",
                            verd_crua== 3 ~ "3 o menys vegades a la setmana",
                            verd_crua== 4 ~ "Entre 4 i 6 vegades a la setmana",
                            verd_crua== 5 ~ "1 o 2 vegades al dia",
                            verd_crua== 6 ~ "1 o 2 vegades al dia",
                            verd_crua== 7 ~ "3 o més vegades al dia")) %>%
  mutate(verd_crua = factor(verd_crua, levels = c("Mai",
                                            "3 o menys vegades a la setmana",
                                            "Entre 4 i 6 vegades a la setmana",
                                            "1 o 2 vegades al dia",
                                            "3 o més vegades al dia"))) %>%
  mutate(verd_cuita = case_when(verd_cuita== 1 ~ "Mai",
                            verd_cuita== 2 ~ "3 o menys vegades a la setmana",
                            verd_cuita== 3 ~ "3 o menys vegades a la setmana",
                            verd_cuita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                            verd_cuita== 5 ~ "1 o 2 vegades al dia",
                            verd_cuita== 6 ~ "1 o 2 vegades al dia",
                            verd_cuita== 7 ~ "3 o més vegades al dia")) %>%
  mutate(verd_cuita = factor(verd_cuita, levels = c("Mai",
                                            "3 o menys vegades a la setmana",
                                            "Entre 4 i 6 vegades a la setmana",
                                            "1 o 2 vegades al dia",
                                            "3 o més vegades al dia"))) %>%
  mutate(carn_verm = case_when(carn_verm== 1 ~ "Mai",
                               carn_verm== 2 ~ "3 o menys vegades al mes",
                               carn_verm== 3 ~ "3 o menys vegades al mes",
                               carn_verm== 4 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 5 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 6 ~ "Entre 3 i 6 vegades a la setmana",
                               carn_verm== 7 ~ "1 o més vegades al dia",)) %>%
  mutate(carn_verm = factor(carn_verm, levels = c("Mai",
                                            "3 o menys vegades al mes",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(refresc = case_when(refresc== 1 ~ "Mai",
                             refresc== 2 ~ "Entre 1 i 3 vegades al mes",
                             refresc== 3 ~ "Entre 1 i 3 vegades a la setmana",
                             refresc== 4 ~ "Entre 4 i 6 vegades a la setmana",
                             refresc== 5 ~ "1 vegada al dia",
                             refresc== 6 ~ "2 o més vegades al dia",
                             refresc== 7 ~ "2 o més vegades al dia")) %>%
  mutate(refresc = factor(refresc, levels = c("Mai",
                                            "Entre 1 i 3 vegades al mes",
                                            "Entre 1 i 3 vegades a la setmana",
                                            "Entre 4 i 6 vegades a la setmana",
                                            "1 vegada al dia",
                                            "2 o més vegades al dia"))) %>%
  mutate(menj_rapid = case_when(menj_rapid== 1 ~ "Mai",
                                menj_rapid== 2 ~ "1 vegada al mes",
                                menj_rapid== 3 ~ "2 o 3 vegades al mes",
                                menj_rapid== 4 ~ "1 o més vegades a la setmana",)) %>%
  mutate(menj_rapid = factor(menj_rapid, levels = c("Mai",
                                            "1 vegada al mes",
                                            "2 o 3 vegades al mes",
                                            "1 o més vegades a la setmana"))) %>%
  mutate(esm_sort = case_when(esm_sort== 1 ~ "Cap vegada",
                              esm_sort== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              esm_sort== 3 ~ "Cada dia",
                              esm_sort== 4 ~ "No pertinent (no surt de casa)")) %>%
  mutate(esm_sort = factor(esm_sort, levels = c("Cap vegada",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Cada dia",
                                                "No pertinent (no surt de casa)"))) %>%
  mutate(pant_sopar = case_when(pant_sopar== 1 ~ "Mai o gairebé mai",
                                pant_sopar== 2 ~ "A vegades",
                                pant_sopar== 3 ~ "Sempre o gairebé sempre")) %>%
  mutate(pant_sopar = factor(pant_sopar, levels = c("Mai o gairebé mai",
                                            "A vegades",
                                            "Sempre o gairebé sempre"))) %>%
  mutate(gana_r = case_when(gana_r== 3 ~ "Mai o gairebé mai",
                            gana_r== 2 ~ "A vegades",
                            gana_r== 1 ~ "Sempre o gairebé sempre")) %>%
  mutate(gana_r = factor(gana_r, levels = c("Mai o gairebé mai",
                                            "A vegades",
                                            "Sempre o gairebé sempre"))) %>%
  select(sexe, verd_crua, verd_cuita, fruita, carn_verm, refresc, menj_rapid,
         esm_sort, dieta, pant_sopar, gana_r) %>%
  tbl_summary(by="sexe",
              percent="column",
              statistic = list(all_continuous() ~ "{mean} ({sd})",        
                               all_categorical() ~ "{n} ({p}%)"),
              label  = list(verd_crua ~ "Verdura crua",
                            verd_cuita ~ "Verdura cuita",
                            fruita ~ "Fruita",
                            carn_verm ~ "Carn vermella",
                            refresc ~ "Begudes ensucrades",
                            menj_rapid ~ "Menjar ràpid",
                            esm_sort ~ "Esmorzar abans de sortir de casa",
                            dieta ~ "Dieta per aprimar-se",
                            pant_sopar ~ "Utilització de pantalles durant el sopar",
                            gana_r ~ "Ha anat al llit amb gana per falta de menjar a casa"),
              missing_text = "Desconegut"
  ) %>% 
  #add_n() %>% 
  add_p() %>%
  #add_overall() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_fresc_sexe <- as_flex_table(taula_fresc_sexe) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Sexe", "", "p-valor²")) %>% 
  merge_at(i = 1, j = 2:3, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 4, part = "header") %>%
  bold(i = 1:2, j = 1:4, part = "header")
  
flextable_fresc_sexe
```

### Per districte i per sexe {.tabset}

#### Noies
```{r fresc_distr_d, echo=FALSE, warning=FALSE, message=FALSE, error=FALSE}
taula_fresc_districte_d <- fresc_21 %>% 
  filter(sexe == 1) %>% 
  mutate(districte_al = case_when(districte_al== 1 ~ "Ciutat Vella",
                                  districte_al== 2 ~ "Eixample",
                                  districte_al== 3 ~ "Sants-Montuïc",
                                  districte_al== 4 ~ "Les Corts",
                                  districte_al== 5 ~ "Sarrià-Sant Gervasi",
                                  districte_al== 6 ~ "Gràcia",
                                  districte_al== 7 ~ "Horta-Guinardó",
                                  districte_al== 8 ~ "Nou Barris",
                                  districte_al== 9 ~ "Sant Andreu",
                                  districte_al== 10 ~ "Sant Martí",
                                  districte_al== 11 ~ "Fora de Barcelona",)) %>%
  mutate(districte_al = factor(districte_al, levels = c("Ciutat Vella",
                                                        "Eixample",
                                                        "Sants-Montuïc",
                                                        "Les Corts",
                                                        "Sarrià-Sant Gervasi",
                                                        "Gràcia",
                                                        "Horta-Guinardó",
                                                        "Nou Barris",
                                                        "Sant Andreu",
                                                        "Sant Martí",
                                                        "Fora de Barcelona"))) %>%
  mutate(fruita = case_when(fruita== 1 ~ "Mai",
                            fruita== 2 ~ "3 o menys vegades a la setmana",
                            fruita== 3 ~ "3 o menys vegades a la setmana",
                            fruita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                            fruita== 5 ~ "1 o 2 vegades al dia",
                            fruita== 6 ~ "1 o 2 vegades al dia",
                            fruita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(fruita = factor(fruita, levels = c("Mai",
                                            "3 o menys vegades a la setmana",
                                            "Entre 4 i 6 vegades a la setmana",
                                            "1 o 2 vegades al dia",
                                            "3 o més vegades al dia"))) %>%
  mutate(verd_crua = case_when(verd_crua== 1 ~ "Mai",
                               verd_crua== 2 ~ "3 o menys vegades a la setmana",
                               verd_crua== 3 ~ "3 o menys vegades a la setmana",
                               verd_crua== 4 ~ "Entre 4 i 6 vegades a la setmana",
                               verd_crua== 5 ~ "1 o 2 vegades al dia",
                               verd_crua== 6 ~ "1 o 2 vegades al dia",
                               verd_crua== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(verd_crua = factor(verd_crua, levels = c("Mai",
                                                  "3 o menys vegades a la setmana",
                                                  "Entre 4 i 6 vegades a la setmana",
                                                  "1 o 2 vegades al dia",
                                                  "3 o més vegades al dia"))) %>%
  mutate(verd_cuita = case_when(verd_cuita== 1 ~ "Mai",
                                verd_cuita== 2 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 3 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                                verd_cuita== 5 ~ "1 o 2 vegades al dia",
                                verd_cuita== 6 ~ "1 o 2 vegades al dia",
                                verd_cuita== 7 ~ "3 o més vegades al dia")) %>%
  mutate(verd_cuita = factor(verd_cuita, levels = c("Mai",
                                                    "3 o menys vegades a la setmana",
                                                    "Entre 4 i 6 vegades a la setmana",
                                                    "1 o 2 vegades al dia",
                                                    "3 o més vegades al dia"))) %>%
  mutate(carn_verm = case_when(carn_verm== 1 ~ "Mai",
                               carn_verm== 2 ~ "3 o menys vegades al mes",
                               carn_verm== 3 ~ "3 o menys vegades al mes",
                               carn_verm== 4 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 5 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 6 ~ "Entre 3 i 6 vegades a la setmana",
                               carn_verm== 7 ~ "1 o més vegades al dia")) %>%
  mutate(carn_verm = factor(carn_verm, levels = c("Mai",
                                                  "3 o menys vegades al mes",
                                                  "1 o 2 vegades a la setmana",
                                                  "Entre 3 i 6 vegades a la setmana",
                                                  "1 o més vegades al dia"))) %>%
  mutate(refresc = case_when(refresc== 1 ~ "Mai",
                             refresc== 2 ~ "Entre 1 i 3 vegades al mes",
                             refresc== 3 ~ "Entre 1 i 3 vegades a la setmana",
                             refresc== 4 ~ "Entre 4 i 6 vegades a la setmana",
                             refresc== 5 ~ "1 vegada al dia",
                             refresc== 6 ~ "2 o més vegades al dia",
                             refresc== 7 ~ "2 o més vegades al dia",)) %>%
  mutate(refresc = factor(refresc, levels = c("Mai",
                                              "Entre 1 i 3 vegades al mes",
                                              "Entre 1 i 3 vegades a la setmana",
                                              "Entre 4 i 6 vegades a la setmana",
                                              "1 vegada al dia",
                                              "2 o més vegades al dia"))) %>%
  mutate(menj_rapid = case_when(menj_rapid== 1 ~ "Mai",
                                menj_rapid== 2 ~ "1 vegada al mes",
                                menj_rapid== 3 ~ "2 o 3 vegades al mes",
                                menj_rapid== 4 ~ "1 o més vegades a la setmana",)) %>%
  mutate(menj_rapid = factor(menj_rapid, levels = c("Mai",
                                                    "1 vegada al mes",
                                                    "2 o 3 vegades al mes",
                                                    "1 o més vegades a la setmana"))) %>%
  mutate(esm_sort = case_when(esm_sort== 1 ~ "Cap vegada",
                              esm_sort== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              esm_sort== 3 ~ "Cada dia",
                              esm_sort== 4 ~ "No pertinent (no surt de casa)")) %>%
  mutate(esm_sort = factor(esm_sort, levels = c("Cap vegada",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Cada dia",
                                                "No pertinent (no surt de casa)"))) %>%
  mutate(pant_sopar = case_when(pant_sopar== 1 ~ "Mai o gairebé mai",
                                pant_sopar== 2 ~ "A vegades",
                                pant_sopar== 3 ~ "Sempre o gairebé sempre")) %>%
  mutate(pant_sopar = factor(pant_sopar, levels = c("Mai o gairebé mai",
                                                    "A vegades",
                                                    "Sempre o gairebé sempre"))) %>%
  mutate(gana_r = case_when(gana_r== 3 ~ "Mai o gairebé mai",
                            gana_r== 2 ~ "A vegades",
                            gana_r== 1 ~ "Sempre o gairebé sempre")) %>%
  mutate(gana_r = factor(gana_r, levels = c("Mai o gairebé mai",
                                            "A vegades",
                                            "Sempre o gairebé sempre"))) %>%
  select(districte_al, verd_crua, verd_cuita, fruita, carn_verm, refresc, menj_rapid,
         esm_sort, dieta, pant_sopar, gana_r) %>%
  tbl_summary(by="districte_al",
              percent="column",
              statistic = list(all_continuous() ~ "{mean} ({sd})",        
                               all_categorical() ~ "{n} ({p}%)"),
              label  = list(verd_crua ~ "Verdura crua",
                            verd_cuita ~ "Verdura cuita",
                            fruita ~ "Fruita",
                            carn_verm ~ "Carn vermella",
                            refresc ~ "Begudes ensucrades",
                            menj_rapid ~ "Menjar ràpid",
                            esm_sort ~ "Esmorzar abans de sortir de casa",
                            dieta ~ "Dieta per aprimar-se",
                            pant_sopar ~ "Utilització de pantalles durant el sopar",
                            gana_r ~ "Ha anat al llit amb gana per falta de menjar a casa"),
              missing_text = "Desconegut"
  ) %>% 
  #add_n() %>% 
  add_p() %>%
  #add_overall() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_fresc_districte_d <- as_flex_table(taula_fresc_districte_d) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Districte", "", "", "", "",
                                     "", "", "", "", "", "", "p-valor²")) %>% 
  merge_at(i = 1, j = 2:12, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 13, part = "header") %>%
  bold(i = 1:2, j = 1:13, part = "header") %>% 
  compose(i = 1, j = 13, part = "body",
        value = as_paragraph("0.634")) %>% 
  compose(i = 8, j = 13, part = "body",
          value = as_paragraph("0.578")) %>% 
  compose(i = 15, j = 13, part = "body",
          value = as_paragraph("0.213")) %>% 
  compose(i = 22, j = 13, part = "body",
          value = as_paragraph("0.416")) %>% 
  compose(i = 29, j = 13, part = "body",
          value = as_paragraph("0.001")) %>% 
  bold(i = 29, j = 13, part = "body") %>%
  compose(i = 37, j = 13, part = "body",
          value = as_paragraph("<0.001")) %>% 
  bold(i = 37, j = 13, part = "body") %>%
  compose(i = 43, j = 13, part = "body",
          value = as_paragraph("0.098")) %>% 
  compose(i = 59, j = 13, part = "body",
          value = as_paragraph("0.009")) %>% 
  bold(i = 59, j = 13, part = "body") %>%
  compose(i = 2, j = 1, part = "footer", 
          value = as_paragraph("²Pearson's Chi-squared test or Fisher's exact test"))
  
flextable_fresc_districte_d
```

#### Nois
```{r fresc_distr_h, echo=FALSE, warning=FALSE, message=FALSE, error=FALSE}

taula_fresc_districte_h <- fresc_21 %>% 
  filter(sexe == 2) %>% 
  mutate(districte_al = case_when(districte_al== 1 ~ "Ciutat Vella",
                                  districte_al== 2 ~ "Eixample",
                                  districte_al== 3 ~ "Sants-Montuïc",
                                  districte_al== 4 ~ "Les Corts",
                                  districte_al== 5 ~ "Sarrià-Sant Gervasi",
                                  districte_al== 6 ~ "Gràcia",
                                  districte_al== 7 ~ "Horta-Guinardó",
                                  districte_al== 8 ~ "Nou Barris",
                                  districte_al== 9 ~ "Sant Andreu",
                                  districte_al== 10 ~ "Sant Martí",
                                  districte_al== 11 ~ "Fora de Barcelona",)) %>%
  mutate(districte_al = factor(districte_al, levels = c("Ciutat Vella",
                                                        "Eixample",
                                                        "Sants-Montuïc",
                                                        "Les Corts",
                                                        "Sarrià-Sant Gervasi",
                                                        "Gràcia",
                                                        "Horta-Guinardó",
                                                        "Nou Barris",
                                                        "Sant Andreu",
                                                        "Sant Martí",
                                                        "Fora de Barcelona"))) %>%
  mutate(fruita = case_when(fruita== 1 ~ "Mai",
                            fruita== 2 ~ "3 o menys vegades a la setmana",
                            fruita== 3 ~ "3 o menys vegades a la setmana",
                            fruita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                            fruita== 5 ~ "1 o 2 vegades al dia",
                            fruita== 6 ~ "1 o 2 vegades al dia",
                            fruita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(fruita = factor(fruita, levels = c("Mai",
                                            "3 o menys vegades a la setmana",
                                            "Entre 4 i 6 vegades a la setmana",
                                            "1 o 2 vegades al dia",
                                            "3 o més vegades al dia"))) %>%
  mutate(verd_crua = case_when(verd_crua== 1 ~ "Mai",
                               verd_crua== 2 ~ "3 o menys vegades a la setmana",
                               verd_crua== 3 ~ "3 o menys vegades a la setmana",
                               verd_crua== 4 ~ "Entre 4 i 6 vegades a la setmana",
                               verd_crua== 5 ~ "1 o 2 vegades al dia",
                               verd_crua== 6 ~ "1 o 2 vegades al dia",
                               verd_crua== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(verd_crua = factor(verd_crua, levels = c("Mai",
                                                  "3 o menys vegades a la setmana",
                                                  "Entre 4 i 6 vegades a la setmana",
                                                  "1 o 2 vegades al dia",
                                                  "3 o més vegades al dia"))) %>%
  mutate(verd_cuita = case_when(verd_cuita== 1 ~ "Mai",
                                verd_cuita== 2 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 3 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                                verd_cuita== 5 ~ "1 o 2 vegades al dia",
                                verd_cuita== 6 ~ "1 o 2 vegades al dia",
                                verd_cuita== 7 ~ "3 o més vegades al dia")) %>%
  mutate(verd_cuita = factor(verd_cuita, levels = c("Mai",
                                                    "3 o menys vegades a la setmana",
                                                    "Entre 4 i 6 vegades a la setmana",
                                                    "1 o 2 vegades al dia",
                                                    "3 o més vegades al dia"))) %>%
  mutate(carn_verm = case_when(carn_verm== 1 ~ "Mai",
                               carn_verm== 2 ~ "3 o menys vegades al mes",
                               carn_verm== 3 ~ "3 o menys vegades al mes",
                               carn_verm== 4 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 5 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 6 ~ "Entre 3 i 6 vegades a la setmana",
                               carn_verm== 7 ~ "1 o més vegades al dia")) %>%
  mutate(carn_verm = factor(carn_verm, levels = c("Mai",
                                                  "3 o menys vegades al mes",
                                                  "1 o 2 vegades a la setmana",
                                                  "Entre 3 i 6 vegades a la setmana",
                                                  "1 o més vegades al dia"))) %>%
  mutate(refresc = case_when(refresc== 1 ~ "Mai",
                             refresc== 2 ~ "Entre 1 i 3 vegades al mes",
                             refresc== 3 ~ "Entre 1 i 3 vegades a la setmana",
                             refresc== 4 ~ "Entre 4 i 6 vegades a la setmana",
                             refresc== 5 ~ "1 vegada al dia",
                             refresc== 6 ~ "2 o més vegades al dia",
                             refresc== 7 ~ "2 o més vegades al dia",)) %>%
  mutate(refresc = factor(refresc, levels = c("Mai",
                                              "Entre 1 i 3 vegades al mes",
                                              "Entre 1 i 3 vegades a la setmana",
                                              "Entre 4 i 6 vegades a la setmana",
                                              "1 vegada al dia",
                                              "2 o més vegades al dia"))) %>%
  mutate(menj_rapid = case_when(menj_rapid== 1 ~ "Mai",
                                menj_rapid== 2 ~ "1 vegada al mes",
                                menj_rapid== 3 ~ "2 o 3 vegades al mes",
                                menj_rapid== 4 ~ "1 o més vegades a la setmana",)) %>%
  mutate(menj_rapid = factor(menj_rapid, levels = c("Mai",
                                                    "1 vegada al mes",
                                                    "2 o 3 vegades al mes",
                                                    "1 o més vegades a la setmana"))) %>%
  mutate(esm_sort = case_when(esm_sort== 1 ~ "Cap vegada",
                              esm_sort== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              esm_sort== 3 ~ "Cada dia",
                              esm_sort== 4 ~ "No pertinent (no surt de casa)")) %>%
  mutate(esm_sort = factor(esm_sort, levels = c("Cap vegada",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Cada dia",
                                                "No pertinent (no surt de casa)"))) %>% 
  mutate(pant_sopar = case_when(pant_sopar== 1 ~ "Mai o gairebé mai",
                                pant_sopar== 2 ~ "A vegades",
                                pant_sopar== 3 ~ "Sempre o gairebé sempre")) %>%
  mutate(pant_sopar = factor(pant_sopar, levels = c("Mai o gairebé mai",
                                                    "A vegades",
                                                    "Sempre o gairebé sempre"))) %>%
  mutate(gana_r = case_when(gana_r== 3 ~ "Mai o gairebé mai",
                            gana_r== 2 ~ "A vegades",
                            gana_r== 1 ~ "Sempre o gairebé sempre")) %>%
  mutate(gana_r = factor(gana_r, levels = c("Mai o gairebé mai",
                                            "A vegades",
                                            "Sempre o gairebé sempre"))) %>%
  select(districte_al, verd_crua, verd_cuita, fruita, carn_verm, refresc, menj_rapid,
         esm_sort, dieta, pant_sopar, gana_r) %>%
  tbl_summary(by="districte_al",
              percent="column",
              statistic = list(all_continuous() ~ "{mean} ({sd})",        
                               all_categorical() ~ "{n} ({p}%)"),
              label  = list(verd_crua ~ "Verdura crua",
                            verd_cuita ~ "Verdura cuita",
                            fruita ~ "Fruita",
                            carn_verm ~ "Carn vermella",
                            refresc ~ "Begudes ensucrades",
                            menj_rapid ~ "Menjar ràpid",
                            esm_sort ~ "Esmorzar abans de sortir de casa",
                            dieta ~ "Dieta per aprimar-se",
                            pant_sopar ~ "Utilització de pantalles durant el sopar",
                            gana_r ~ "Ha anat al llit amb gana per falta de menjar a casa"),
              missing_text = "Desconegut"
  ) %>% 
  #add_n() %>% 
  add_p() %>%
  #add_overall() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_fresc_districte_h <- as_flex_table(taula_fresc_districte_h) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Districte", "", "", "", "",
                                     "", "", "", "", "", "", "p-valor²")) %>% 
  merge_at(i = 1, j = 2:12, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 13, part = "header") %>%
  bold(i = 1:2, j = 1:13, part = "header") %>% 
  compose(i = 1, j = 13, part = "body",
        value = as_paragraph("0.310")) %>% 
  compose(i = 8, j = 13, part = "body",
          value = as_paragraph("0.068")) %>% 
  compose(i = 15, j = 13, part = "body",
          value = as_paragraph("0.548")) %>% 
  compose(i = 22, j = 13, part = "body",
          value = as_paragraph("0.030")) %>% 
  bold(i = 22, j = 13, part = "body") %>%
  compose(i = 29, j = 13, part = "body",
          value = as_paragraph("0.051")) %>% 
  compose(i = 37, j = 13, part = "body",
          value = as_paragraph("0.316")) %>% 
  compose(i = 43, j = 13, part = "body",
          value = as_paragraph("0.086")) %>% 
  compose(i = 59, j = 13, part = "body",
          value = as_paragraph("0.020")) %>% 
  bold(i = 59, j = 13, part = "body") %>%
  compose(i = 2, j = 1, part = "footer", 
          value = as_paragraph("²Pearson's Chi-squared test or Fisher's exact test"))
  
flextable_fresc_districte_h
```

### Mapes per districte i segons sexe {.tabset}

#### Verdura crua

```{r maps3, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}
library(rgdal)
library(foreign)
library(readxl)
library(Hmisc)
library(RColorBrewer)
library(dplyr)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

#crear la variable verdura crua més d'1 vegada al dia
fresc_21 <- fresc_21 %>% 
  mutate(verd_crua_1=case_when(verd_crua==1 ~ 0, verd_crua==2 ~ 0,verd_crua==3 ~ 0,
                             verd_crua==4 ~ 0,verd_crua==5 ~ 1,verd_crua==6 ~ 1,
                            verd_crua==7 ~ 1))

df3 <- fresc_21 %>% 
  filter(sexe==1) %>% 
  group_by(districte_al) %>% 
  summarise(verd_crua_1 = sum(verd_crua_1, na.rm=TRUE), n=n())
  
df3$prop3 <- df3$verd_crua_1/df3$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df3, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

#df1$prop <- format(round(df1$prop, 2), nsmall = 2)

#df1$prop <- as.numeric(df1$prop)

#par(mar=c(1,1,1,1))
#Li dic que m'ha de fer quintils de les taxes
Cortes3 <- cut2(districtes$prop3, g=5, digits=5)
valores3 <- as.numeric(Cortes3)
mypalette3<-brewer.pal(5,"Blues")
fgs<-mypalette3[valores3]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de verdura crua una o més vegades al dia en noies", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes3), fill=mypalette3, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

#crear la variable verdura crua més d'1 vegada al dia
fresc_21 <- fresc_21 %>% 
  mutate(verd_crua_1=case_when(verd_crua==1 ~ 0, verd_crua==2 ~ 0,verd_crua==3 ~ 0,
                             verd_crua==4 ~ 0,verd_crua==5 ~ 1,verd_crua==6 ~ 1,
                            verd_crua==7 ~ 1))

df3 <- fresc_21 %>% 
  filter(sexe==2) %>% 
  group_by(districte_al) %>% 
  summarise(verd_crua_1 = sum(verd_crua_1, na.rm=TRUE), n=n())
  
df3$prop3 <- df3$verd_crua_1/df3$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df3, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

#df1$prop <- format(round(df1$prop, 2), nsmall = 2)

#df1$prop <- as.numeric(df1$prop)

#par(mar=c(1,1,1,1))
#Li dic que m'ha de fer quintils de les taxes
Cortes3 <- cut2(districtes$prop3, g=5, digits=5)
valores3 <- as.numeric(Cortes3)
mypalette3<-brewer.pal(5,"Greens")
fgs<-mypalette3[valores3]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de verdura crua una o més vegades al dia en nois", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes3), fill=mypalette3, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

```

#### Verdura cuita

```{r maps2, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(verd_cuita_1=case_when(verd_cuita==1 ~ 0, verd_cuita==2 ~ 0,verd_cuita==3 ~ 0,
                             verd_cuita==4 ~ 0,verd_cuita==5 ~ 1,verd_cuita==6 ~ 1,
                            verd_cuita==7 ~ 1))

df2 <- fresc_21 %>% 
  filter(sexe==1) %>% 
  group_by(districte_al) %>% 
  summarise(verd_cuita_1 = sum(verd_cuita_1, na.rm=TRUE), n=n())
  
df2$prop2 <- df2$verd_cuita_1/df2$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df2, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes2 <- cut2(districtes$prop2, g=5, digits=5)
valores2 <- as.numeric(Cortes2)
mypalette2<-brewer.pal(5,"Blues")
fgs<-mypalette2[valores2]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de verdura cuita una o més vegades al dia en noies", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes2), fill=mypalette2, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(verd_cuita_1=case_when(verd_cuita==1 ~ 0, verd_cuita==2 ~ 0,verd_cuita==3 ~ 0,
                             verd_cuita==4 ~ 0,verd_cuita==5 ~ 1,verd_cuita==6 ~ 1,
                            verd_cuita==7 ~ 1))

df2 <- fresc_21 %>% 
  filter(sexe==2) %>% 
  group_by(districte_al) %>% 
  summarise(verd_cuita_1 = sum(verd_cuita_1, na.rm=TRUE), n=n())
  
df2$prop2 <- df2$verd_cuita_1/df2$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df2, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes2 <- cut2(districtes$prop2, g=5, digits=5)
valores2 <- as.numeric(Cortes2)
mypalette2<-brewer.pal(5,"Greens")
fgs<-mypalette2[valores2]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de verdura cuita una o més vegades al dia en nois", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes2), fill=mypalette2, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

#### Fruita

```{r maps1, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(fruita_1=case_when(fruita==1 ~ 0, fruita==2 ~ 0,fruita==3 ~ 0,
                             fruita==4 ~ 0,fruita==5 ~ 0,fruita==6 ~ 0,
                            fruita==7 ~ 1))

df1 <- fresc_21 %>% 
  filter(sexe==1) %>% 
  group_by(districte_al) %>% 
  summarise(fruita_1 = sum(fruita_1, na.rm=TRUE), n=n())
  
df1$prop <- df1$fruita_1/df1$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df1, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes1 <- cut2(districtes$prop, g=5, digits=5)
valores1 <- as.numeric(Cortes1)
mypalette1<-brewer.pal(5,"Blues")
fgs<-mypalette1[valores1]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de fruita tres o més vegades al dia en noies", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes1), fill=mypalette1, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(fruita_1=case_when(fruita==1 ~ 0, fruita==2 ~ 0,fruita==3 ~ 0,
                             fruita==4 ~ 0,fruita==5 ~ 0,fruita==6 ~ 0,
                            fruita==7 ~ 1))

df1 <- fresc_21 %>% 
  filter(sexe==2) %>% 
  group_by(districte_al) %>% 
  summarise(fruita_1 = sum(fruita_1, na.rm=TRUE), n=n())
  
df1$prop <- df1$fruita_1/df1$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df1, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes1 <- cut2(districtes$prop, g=5, digits=5)
valores1 <- as.numeric(Cortes1)
mypalette1<-brewer.pal(5,"Greens")
fgs<-mypalette1[valores1]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de fruita tres o més vegades al dia en nois", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes1), fill=mypalette1, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

#### Carn vermella

```{r maps4, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(carn_verm_1=case_when(carn_verm==1 ~ 0, carn_verm==2 ~ 0,carn_verm==3 ~ 0,
                             carn_verm==4 ~ 0, carn_verm==5 ~ 0, carn_verm==6 ~ 1,
                             carn_verm==7 ~ 1))

df4 <- fresc_21 %>% 
  filter(sexe==1) %>% 
  group_by(districte_al) %>% 
  summarise(carn_verm_1 = sum(carn_verm_1, na.rm=TRUE), n=n())
  
df4$prop4 <- df4$carn_verm_1/df4$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df4, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes4 <- cut2(districtes$prop4, g=5, digits=5)
valores4 <- as.numeric(Cortes4)
mypalette4<-brewer.pal(5,"Blues")
fgs<-mypalette4[valores4]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de carn vermella tres o més
      vegades a la setmana en noies", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes4), fill=mypalette4, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(carn_verm_1=case_when(carn_verm==1 ~ 0, carn_verm==2 ~ 0,carn_verm==3 ~ 0,
                             carn_verm==4 ~ 0, carn_verm==5 ~ 0, carn_verm==6 ~ 1,
                             carn_verm==7 ~ 1))

df4 <- fresc_21 %>% 
  filter(sexe==2) %>% 
  group_by(districte_al) %>% 
  summarise(carn_verm_1 = sum(carn_verm_1, na.rm=TRUE), n=n())
  
df4$prop4 <- df4$carn_verm_1/df4$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df4, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes4 <- cut2(districtes$prop4, g=5, digits=5)
valores4 <- as.numeric(Cortes4)
mypalette4<-brewer.pal(5,"Greens")
fgs<-mypalette4[valores4]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de carn vermella tres o més
      vegades a la setmana en nois", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes4), fill=mypalette4, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

#### Begudes ensucrades

```{r maps5, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(refresc_1=case_when(refresc==1 ~ 0, refresc==2 ~ 1,refresc==3 ~ 1,
                             refresc==4 ~ 1, refresc==5 ~ 1, refresc==6 ~ 1,
                             refresc==7 ~ 1))

df5 <- fresc_21 %>% 
  filter(sexe==1) %>% 
  group_by(districte_al) %>% 
  summarise(refresc_1 = sum(refresc_1, na.rm=TRUE), n=n())
  
df5$prop5 <- df5$refresc_1/df5$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df5, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes5 <- cut2(districtes$prop5, g=5, digits=5)
valores5 <- as.numeric(Cortes5)
mypalette5<-brewer.pal(5,"Blues")
fgs<-mypalette5[valores5]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de begudes ensucrades una
      o més vegades al mes en noies", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes5), fill=mypalette5, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(refresc_1=case_when(refresc==1 ~ 0, refresc==2 ~ 1,refresc==3 ~ 1,
                             refresc==4 ~ 1, refresc==5 ~ 1, refresc==6 ~ 1,
                             refresc==7 ~ 1))

df5 <- fresc_21 %>% 
  filter(sexe==2) %>% 
  group_by(districte_al) %>% 
  summarise(refresc_1 = sum(refresc_1, na.rm=TRUE), n=n())
  
df5$prop5 <- df5$refresc_1/df5$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df5, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes5 <- cut2(districtes$prop5, g=5, digits=5)
valores5 <- as.numeric(Cortes5)
mypalette5<-brewer.pal(5,"Greens")
fgs<-mypalette5[valores5]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de begudes ensucrades una
      o més vegades al mes en nois", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes5), fill=mypalette5, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

#### Menjar ràpid

```{r maps6, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(menj_rapid_1=case_when(menj_rapid==1 ~ 0, menj_rapid==2 ~ 1,menj_rapid==3 ~ 1,
                             menj_rapid==4 ~ 1))

df6 <- fresc_21 %>% 
  filter(sexe==1) %>% 
  group_by(districte_al) %>% 
  summarise(menj_rapid_1 = sum(menj_rapid_1, na.rm=TRUE), n=n())
  
df6$prop6 <- df6$menj_rapid_1/df6$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df6, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes6 <- cut2(districtes$prop6, g=5, digits=5)
valores6 <- as.numeric(Cortes6)
mypalette6<-brewer.pal(5,"Blues")
fgs<-mypalette6[valores6]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de menjar ràpid una o més vegades al mes en noies", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes6), fill=mypalette6, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(menj_rapid_1=case_when(menj_rapid==1 ~ 0, menj_rapid==2 ~ 1,menj_rapid==3 ~ 1,
                             menj_rapid==4 ~ 1))

df6 <- fresc_21 %>% 
  filter(sexe==2) %>% 
  group_by(districte_al) %>% 
  summarise(menj_rapid_1 = sum(menj_rapid_1, na.rm=TRUE), n=n())
  
df6$prop6 <- df6$menj_rapid_1/df6$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df6, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes6 <- cut2(districtes$prop6, g=5, digits=5)
valores6 <- as.numeric(Cortes6)
mypalette6<-brewer.pal(5,"Greens")
fgs<-mypalette6[valores6]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de menjar ràpid una o més vegades al mes en nois", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes6), fill=mypalette6, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

#### Esmorzar

```{r maps7, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(esmorzar_1=case_when(esm_sort==1 ~ 0, esm_sort==2 ~ 0,esm_sort==3 ~ 1,
                             esm_sort==4 ~ 2)) %>% 
  replace_with_na(replace = list(esmorzar_1 = 2))

df7 <- fresc_21 %>% 
  filter(sexe==1) %>% 
  group_by(districte_al) %>% 
  summarise(esmorzar_1 = sum(esmorzar_1, na.rm=TRUE), n=n())
  
df7$prop7 <- df7$esmorzar_1/df7$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df7, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes7 <- cut2(districtes$prop7, g=5, digits=5)
valores7 <- as.numeric(Cortes7)
mypalette7<-brewer.pal(5,"Blues")
fgs<-mypalette7[valores7]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Esmorzar sempre abans de sortir de casa en noies", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes7), fill=mypalette7, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(esmorzar_1=case_when(esm_sort==1 ~ 0, esm_sort==2 ~ 0,esm_sort==3 ~ 1,
                             esm_sort==4 ~ 2)) %>% 
  replace_with_na(replace = list(esmorzar_1 = 2))

df7 <- fresc_21 %>% 
  filter(sexe==2) %>% 
  group_by(districte_al) %>% 
  summarise(esmorzar_1 = sum(esmorzar_1, na.rm=TRUE), n=n())
  
df7$prop7 <- df7$esmorzar_1/df7$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df7, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes7 <- cut2(districtes$prop7, g=5, digits=5)
valores7 <- as.numeric(Cortes7)
mypalette7<-brewer.pal(5,"Greens")
fgs<-mypalette7[valores7]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Esmorzar sempre abans de sortir de casa en nois", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes7), fill=mypalette7, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

#### Fer dieta

```{r maps8, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(dieta_1=case_when(dieta=="Està fent dieta" ~ 1, dieta=="Ha fet dieta alguna   vegada" ~ 1, dieta=="Mai ha fet dieta" ~ 0))

df8 <- fresc_21 %>% 
  filter(sexe==1) %>% 
  group_by(districte_al) %>% 
  summarise(dieta_1 = sum(dieta_1, na.rm=TRUE), n=n())
  
df8$prop8 <- df8$dieta_1/df8$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df8, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes8 <- cut2(districtes$prop8, g=5, digits=5)
valores8 <- as.numeric(Cortes8)
mypalette8<-brewer.pal(5,"Blues")
fgs<-mypalette8[valores8]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Noies que estan fent i/o han fet dieta per aprimar-se", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes8), fill=mypalette8, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(dieta_1=case_when(dieta=="Està fent dieta" ~ 1, dieta=="Ha fet dieta alguna   vegada" ~ 1, dieta=="Mai ha fet dieta" ~ 0))

df8 <- fresc_21 %>% 
  filter(sexe==2) %>% 
  group_by(districte_al) %>% 
  summarise(dieta_1 = sum(dieta_1, na.rm=TRUE), n=n())
  
df8$prop8 <- df8$dieta_1/df8$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df8, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes8 <- cut2(districtes$prop8, g=5, digits=5)
valores8 <- as.numeric(Cortes8)
mypalette8<-brewer.pal(5,"Greens")
fgs<-mypalette8[valores8]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Nois que estan fent i/o han fet dieta per aprimar-se", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes8), fill=mypalette8, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
``` 

#### Ús de pantalles

```{r maps9, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(pant_sopar_1=case_when(pant_sopar==1 ~ 0, pant_sopar==2 ~ 0, 
                                pant_sopar==3 ~ 1))

df9 <- fresc_21 %>%
  filter(sexe==1) %>% 
  group_by(districte_al) %>% 
  summarise(pant_sopar_1 = sum(pant_sopar_1, na.rm=TRUE), n=n())
  
df9$prop9 <- df9$pant_sopar_1/df9$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df9, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes9 <- cut2(districtes$prop9, g=5, digits=5)
valores9 <- as.numeric(Cortes9)
mypalette9<-brewer.pal(5,"Blues")
fgs<-mypalette9[valores9]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Noies que utilitzen sempre o gairebé sempre
      alguna pantalla durant el sopar", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes9), fill=mypalette9, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(pant_sopar_1=case_when(pant_sopar==1 ~ 0, pant_sopar==2 ~ 0, 
                                pant_sopar==3 ~ 1))

df9 <- fresc_21 %>%
  filter(sexe==2) %>% 
  group_by(districte_al) %>% 
  summarise(pant_sopar_1 = sum(pant_sopar_1, na.rm=TRUE), n=n())
  
df9$prop9 <- df9$pant_sopar_1/df9$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df9, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes9 <- cut2(districtes$prop9, g=5, digits=5)
valores9 <- as.numeric(Cortes9)
mypalette9<-brewer.pal(5,"Greens")
fgs<-mypalette9[valores9]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Nois que utilitzen sempre o gairebé sempre
      alguna pantalla durant el sopar", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes9), fill=mypalette9, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

#### Inseguretat alimentària

```{r maps10, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(gana_r_1=case_when(gana_r==1 ~ 1, gana_r==2 ~ 1, 
                                gana_r==3 ~ 0))

df10 <- fresc_21 %>% 
  filter(sexe==1) %>% 
  group_by(districte_al) %>% 
  summarise(gana_r_1 = sum(gana_r_1, na.rm=TRUE), n=n())
  
df10$prop10 <- df10$gana_r_1/df10$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df10, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes10 <- cut2(districtes$prop10, g=5, digits=5)
valores10 <- as.numeric(Cortes10)
mypalette10<-brewer.pal(5,"Blues")
fgs<-mypalette10[valores10]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Noies que sempre, sovint o algunes vegades ha anat al
      llit amb gana per falta de menjar a casa", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes10), fill=mypalette10, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

fresc_21 <- fresc_21 %>% 
  mutate(gana_r_1=case_when(gana_r==1 ~ 1, gana_r==2 ~ 1, 
                                gana_r==3 ~ 0))

df10 <- fresc_21 %>% 
  filter(sexe==2) %>% 
  group_by(districte_al) %>% 
  summarise(gana_r_1 = sum(gana_r_1, na.rm=TRUE), n=n())
  
df10$prop10 <- df10$gana_r_1/df10$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df10, by.x="DISTRICTE",by.y="districte_al",all.x=TRUE,all.y=TRUE)

Cortes10 <- cut2(districtes$prop10, g=5, digits=5)
valores10 <- as.numeric(Cortes10)
mypalette10<-brewer.pal(5,"Greens")
fgs<-mypalette10[valores10]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Nois que sempre, sovint o algunes vegades ha anat al
      llit amb gana per falta de menjar a casa", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes10), fill=mypalette10, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

### Per curs i per sexe {.tabset}

#### Noies

```{r curs_d, echo=FALSE, message=FALSE, error=FALSE, warning=FALSE}
taula_fresc_curs_d <- fresc_21 %>%
  filter(sexe==1) %>% 
  mutate(CURS_3 = case_when(CURS_3== 1 ~ "2n d'ESO", CURS_3== 2 ~ "4t d'ESO",
                            CURS_3== 3 ~ "2n de Batx", CURS_3== 4 ~ "2n CFGM")) %>%
  mutate(CURS_3 = factor(CURS_3, levels = c("2n d'ESO",
                                            "4t d'ESO",
                                            "2n de Batx",
                                            "2n CFGM"))) %>%
  mutate(fruita = case_when(fruita== 1 ~ "Mai",
                            fruita== 2 ~ "3 o menys vegades a la setmana",
                            fruita== 3 ~ "3 o menys vegades a la setmana",
                            fruita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                            fruita== 5 ~ "1 o 2 vegades al dia",
                            fruita== 6 ~ "1 o 2 vegades al dia",
                            fruita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(fruita = factor(fruita, levels = c("Mai",
                                            "3 o menys vegades a la setmana",
                                            "Entre 4 i 6 vegades a la setmana",
                                            "1 o 2 vegades al dia",
                                            "3 o més vegades al dia"))) %>%
  mutate(verd_crua = case_when(verd_crua== 1 ~ "Mai",
                               verd_crua== 2 ~ "3 o menys vegades a la setmana",
                               verd_crua== 3 ~ "3 o menys vegades a la setmana",
                               verd_crua== 4 ~ "Entre 4 i 6 vegades a la setmana",
                               verd_crua== 5 ~ "1 o 2 vegades al dia",
                               verd_crua== 6 ~ "1 o 2 vegades al dia",
                               verd_crua== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(verd_crua = factor(verd_crua, levels = c("Mai",
                                                  "3 o menys vegades a la setmana",
                                                  "Entre 4 i 6 vegades a la setmana",
                                                  "1 o 2 vegades al dia",
                                                  "3 o més vegades al dia"))) %>%
  mutate(verd_cuita = case_when(verd_cuita== 1 ~ "Mai",
                                verd_cuita== 2 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 3 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                                verd_cuita== 5 ~ "1 o 2 vegades al dia",
                                verd_cuita== 6 ~ "1 o 2 vegades al dia",
                                verd_cuita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(verd_cuita = factor(verd_cuita, levels = c("Mai",
                                                    "3 o menys vegades a la setmana",
                                                    "Entre 4 i 6 vegades a la setmana",
                                                    "1 o 2 vegades al dia",
                                                    "3 o més vegades al dia"))) %>%
  mutate(carn_verm = case_when(carn_verm== 1 ~ "Mai",
                               carn_verm== 2 ~ "3 o menys vegades al mes",
                               carn_verm== 3 ~ "3 o menys vegades al mes",
                               carn_verm== 4 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 5 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 6 ~ "Entre 3 i 6 vegades a la setmana",
                               carn_verm== 7 ~ "1 o més vegades al dia",)) %>%
  mutate(carn_verm = factor(carn_verm, levels = c("Mai",
                                                  "3 o menys vegades al mes",
                                                  "1 o 2 vegades a la setmana",
                                                  "Entre 3 i 6 vegades a la setmana",
                                                  "1 o més vegades al dia"))) %>%
  mutate(refresc = case_when(refresc== 1 ~ "Mai",
                             refresc== 2 ~ "Entre 1 i 3 vegades al mes",
                             refresc== 3 ~ "Entre 1 i 3 vegades a la setmana",
                             refresc== 4 ~ "Entre 4 i 6 vegades a la setmana",
                             refresc== 5 ~ "1 vegada al dia",
                             refresc== 6 ~ "2 o més vegades al dia",
                             refresc== 7 ~ "2 o més vegades al dia",)) %>%
  mutate(refresc = factor(refresc, levels = c("Mai",
                                              "Entre 1 i 3 vegades al mes",
                                              "Entre 1 i 3 vegades a la setmana",
                                              "Entre 4 i 6 vegades a la setmana",
                                              "1 vegada al dia",
                                              "2 o més vegades al dia"))) %>%
  mutate(menj_rapid = case_when(menj_rapid== 1 ~ "Mai",
                                menj_rapid== 2 ~ "1 vegada al mes",
                                menj_rapid== 3 ~ "2 o 3 vegades al mes",
                                menj_rapid== 4 ~ "1 o més vegades a la setmana",)) %>%
  mutate(menj_rapid = factor(menj_rapid, levels = c("Mai",
                                                    "1 vegada al mes",
                                                    "2 o 3 vegades al mes",
                                                    "1 o més vegades a la setmana"))) %>%
  mutate(esm_sort = case_when(esm_sort== 1 ~ "Cap vegada",
                              esm_sort== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              esm_sort== 3 ~ "Cada dia",
                              esm_sort== 4 ~ "No pertinent (no surt de casa)")) %>%
  mutate(esm_sort = factor(esm_sort, levels = c("Cap vegada",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Cada dia",
                                                "No pertinent (no surt de casa)"))) %>% 
  mutate(pant_sopar = case_when(pant_sopar== 1 ~ "Mai o gairebé mai",
                                pant_sopar== 2 ~ "A vegades",
                                pant_sopar== 3 ~ "Sempre o gairebé sempre")) %>%
  mutate(pant_sopar = factor(pant_sopar, levels = c("Mai o gairebé mai",
                                                    "A vegades",
                                                    "Sempre o gairebé sempre"))) %>%
  mutate(gana_r = case_when(gana_r== 3 ~ "Mai o gairebé mai",
                            gana_r== 2 ~ "A vegades",
                            gana_r== 1 ~ "Sempre o gairebé sempre")) %>%
  mutate(gana_r = factor(gana_r, levels = c("Mai o gairebé mai",
                                            "A vegades",
                                            "Sempre o gairebé sempre"))) %>%
  select(CURS_3, verd_crua, verd_cuita, fruita, carn_verm, refresc, menj_rapid,
         esm_sort, dieta, pant_sopar, gana_r) %>%
  tbl_summary(by="CURS_3",
              percent="column",
              statistic = list(all_continuous() ~ "{mean} ({sd})",        
                               all_categorical() ~ "{n} ({p}%)"),
              label  = list(verd_crua ~ "Verdura crua",
                            verd_cuita ~ "Verdura cuita",
                            fruita ~ "Fruita",
                            carn_verm ~ "Carn vermella",
                            refresc ~ "Begudes ensucrades",
                            menj_rapid ~ "Menjar ràpid",
                            esm_sort ~ "Esmorzar abans de sortir de casa",
                            dieta ~ "Dieta per aprimar-se",
                            pant_sopar ~ "Utilització de pantalles durant el sopar",
                            gana_r ~ "Ha anat al llit amb gana per falta de menjar a casa"),
              missing_text = "Desconegut"
  ) %>% 
  #add_n() %>% 
  add_p() %>%
  #add_overall() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_fresc_curs_d <- as_flex_table(taula_fresc_curs_d) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Curs", "", "", "", "p-valor²")) %>% 
  merge_at(i = 1, j = 2:5, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 6, part = "header") %>%
  bold(i = 1:2, j = 1:6, part = "header") %>% 
  compose(i = 8, j = 6, part = "body",
          value = as_paragraph("<0.001")) %>% 
  bold(i = 8, j = 6, part = "body") %>%
  compose(i = 43, j = 6, part = "body",
          value = as_paragraph("<0.001")) %>%   
  bold(i = 43, j = 6, part = "body") %>%
  compose(i = 59, j = 6, part = "body",
          value = as_paragraph("0.086"))%>%
  compose(i = 2, j = 1, part = "footer", 
          value = as_paragraph("²Pearson's Chi-squared test or Fisher's exact test"))

flextable_fresc_curs_d
```

#### Nois

```{r curs_h, echo=FALSE, message=FALSE, error=FALSE, warning=FALSE}
taula_fresc_curs_h <- fresc_21 %>%
  filter(sexe==2) %>% 
  mutate(CURS_3 = case_when(CURS_3== 1 ~ "2n d'ESO", CURS_3== 2 ~ "4t d'ESO",
                            CURS_3== 3 ~ "2n de Batx", CURS_3== 4 ~ "2n CFGM")) %>%
  mutate(CURS_3 = factor(CURS_3, levels = c("2n d'ESO",
                                            "4t d'ESO",
                                            "2n de Batx",
                                            "2n CFGM"))) %>%
  mutate(fruita = case_when(fruita== 1 ~ "Mai",
                            fruita== 2 ~ "3 o menys vegades a la setmana",
                            fruita== 3 ~ "3 o menys vegades a la setmana",
                            fruita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                            fruita== 5 ~ "1 o 2 vegades al dia",
                            fruita== 6 ~ "1 o 2 vegades al dia",
                            fruita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(fruita = factor(fruita, levels = c("Mai",
                                            "3 o menys vegades a la setmana",
                                            "Entre 4 i 6 vegades a la setmana",
                                            "1 o 2 vegades al dia",
                                            "3 o més vegades al dia"))) %>%
  mutate(verd_crua = case_when(verd_crua== 1 ~ "Mai",
                               verd_crua== 2 ~ "3 o menys vegades a la setmana",
                               verd_crua== 3 ~ "3 o menys vegades a la setmana",
                               verd_crua== 4 ~ "Entre 4 i 6 vegades a la setmana",
                               verd_crua== 5 ~ "1 o 2 vegades al dia",
                               verd_crua== 6 ~ "1 o 2 vegades al dia",
                               verd_crua== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(verd_crua = factor(verd_crua, levels = c("Mai",
                                                  "3 o menys vegades a la setmana",
                                                  "Entre 4 i 6 vegades a la setmana",
                                                  "1 o 2 vegades al dia",
                                                  "3 o més vegades al dia"))) %>%
  mutate(verd_cuita = case_when(verd_cuita== 1 ~ "Mai",
                                verd_cuita== 2 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 3 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                                verd_cuita== 5 ~ "1 o 2 vegades al dia",
                                verd_cuita== 6 ~ "1 o 2 vegades al dia",
                                verd_cuita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(verd_cuita = factor(verd_cuita, levels = c("Mai",
                                                    "3 o menys vegades a la setmana",
                                                    "Entre 4 i 6 vegades a la setmana",
                                                    "1 o 2 vegades al dia",
                                                    "3 o més vegades al dia"))) %>%
  mutate(carn_verm = case_when(carn_verm== 1 ~ "Mai",
                               carn_verm== 2 ~ "3 o menys vegades al mes",
                               carn_verm== 3 ~ "3 o menys vegades al mes",
                               carn_verm== 4 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 5 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 6 ~ "Entre 3 i 6 vegades a la setmana",
                               carn_verm== 7 ~ "1 o més vegades al dia",)) %>%
  mutate(carn_verm = factor(carn_verm, levels = c("Mai",
                                                  "3 o menys vegades al mes",
                                                  "1 o 2 vegades a la setmana",
                                                  "Entre 3 i 6 vegades a la setmana",
                                                  "1 o més vegades al dia"))) %>%
  mutate(refresc = case_when(refresc== 1 ~ "Mai",
                             refresc== 2 ~ "Entre 1 i 3 vegades al mes",
                             refresc== 3 ~ "Entre 1 i 3 vegades a la setmana",
                             refresc== 4 ~ "Entre 4 i 6 vegades a la setmana",
                             refresc== 5 ~ "1 vegada al dia",
                             refresc== 6 ~ "2 o més vegades al dia",
                             refresc== 7 ~ "2 o més vegades al dia",)) %>%
  mutate(refresc = factor(refresc, levels = c("Mai",
                                              "Entre 1 i 3 vegades al mes",
                                              "Entre 1 i 3 vegades a la setmana",
                                              "Entre 4 i 6 vegades a la setmana",
                                              "1 vegada al dia",
                                              "2 o més vegades al dia"))) %>%
  mutate(menj_rapid = case_when(menj_rapid== 1 ~ "Mai",
                                menj_rapid== 2 ~ "1 vegada al mes",
                                menj_rapid== 3 ~ "2 o 3 vegades al mes",
                                menj_rapid== 4 ~ "1 o més vegades a la setmana",)) %>%
  mutate(menj_rapid = factor(menj_rapid, levels = c("Mai",
                                                    "1 vegada al mes",
                                                    "2 o 3 vegades al mes",
                                                    "1 o més vegades a la setmana"))) %>%
  mutate(esm_sort = case_when(esm_sort== 1 ~ "Cap vegada",
                              esm_sort== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              esm_sort== 3 ~ "Cada dia",
                              esm_sort== 4 ~ "No pertinent (no surt de casa)")) %>%
  mutate(esm_sort = factor(esm_sort, levels = c("Cap vegada",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Cada dia",
                                                "No pertinent (no surt de casa)"))) %>% 
  mutate(pant_sopar = case_when(pant_sopar== 1 ~ "Mai o gairebé mai",
                                pant_sopar== 2 ~ "A vegades",
                                pant_sopar== 3 ~ "Sempre o gairebé sempre")) %>%
  mutate(pant_sopar = factor(pant_sopar, levels = c("Mai o gairebé mai",
                                                    "A vegades",
                                                    "Sempre o gairebé sempre"))) %>%
  mutate(gana_r = case_when(gana_r== 3 ~ "Mai o gairebé mai",
                            gana_r== 2 ~ "A vegades",
                            gana_r== 1 ~ "Sempre o gairebé sempre")) %>%
  mutate(gana_r = factor(gana_r, levels = c("Mai o gairebé mai",
                                            "A vegades",
                                            "Sempre o gairebé sempre"))) %>%
  select(CURS_3, verd_crua, verd_cuita, fruita, carn_verm, refresc, menj_rapid,
         esm_sort, dieta, pant_sopar, gana_r) %>%
  tbl_summary(by="CURS_3",
              percent="column",
              statistic = list(all_continuous() ~ "{mean} ({sd})",        
                               all_categorical() ~ "{n} ({p}%)"),
              label  = list(verd_crua ~ "Verdura crua",
                            verd_cuita ~ "Verdura cuita",
                            fruita ~ "Fruita",
                            carn_verm ~ "Carn vermella",
                            refresc ~ "Begudes ensucrades",
                            menj_rapid ~ "Menjar ràpid",
                            esm_sort ~ "Esmorzar abans de sortir de casa",
                            dieta ~ "Dieta per aprimar-se",
                            pant_sopar ~ "Utilització de pantalles durant el sopar",
                            gana_r ~ "Ha anat al llit amb gana per falta de menjar a casa"),
              missing_text = "Desconegut"
  ) %>% 
  #add_n() %>% 
  add_p() %>%
  #add_overall() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_fresc_curs_h <- as_flex_table(taula_fresc_curs_h) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Curs", "", "", "", "p-valor²")) %>% 
  merge_at(i = 1, j = 2:5, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 6, part = "header") %>%
  bold(i = 1:2, j = 1:6, part = "header") %>% 
  compose(i = 1, j = 6, part = "body",
        value = as_paragraph("0.022")) %>% 
  bold(i = 1, j = 6, part = "body") %>% 
  compose(i = 8, j = 6, part = "body",
          value = as_paragraph("0.099")) %>% 
  compose(i = 22, j = 6, part = "body",
          value = as_paragraph("0.060")) %>% 
  compose(i = 43, j = 6, part = "body",
          value = as_paragraph("<0.001")) %>% 
  bold(i = 43, j = 6, part = "body") %>% 
  compose(i = 59, j = 6, part = "body",
          value = as_paragraph("0.200"))%>%
  compose(i = 2, j = 1, part = "footer", 
          value = as_paragraph("²Pearson's Chi-squared test or Fisher's exact test"))

flextable_fresc_curs_h
```

### Per nivell socioeconòmic i per sexe {.tabset}

#### Noies

```{r nse_d, echo=FALSE, message=FALSE, error=FALSE, warning=FALSE}
taula_fresc_nse_d <- fresc_21 %>%
  filter(sexe==1) %>% 
  mutate(FAS_cat = case_when(FAS_cat== 1 ~ "Baix", FAS_cat== 2 ~ "Mig",
                            FAS_cat== 3 ~ "Alt")) %>%
  mutate(FAS_cat = factor(FAS_cat, levels = c("Baix",
                                            "Mig",
                                            "Alt"))) %>%
  mutate(fruita = case_when(fruita== 1 ~ "Mai",
                            fruita== 2 ~ "3 o menys vegades a la setmana",
                            fruita== 3 ~ "3 o menys vegades a la setmana",
                            fruita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                            fruita== 5 ~ "1 o 2 vegades al dia",
                            fruita== 6 ~ "1 o 2 vegades al dia",
                            fruita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(fruita = factor(fruita, levels = c("Mai",
                                            "3 o menys vegades a la setmana",
                                            "Entre 4 i 6 vegades a la setmana",
                                            "1 o 2 vegades al dia",
                                            "3 o més vegades al dia"))) %>%
  mutate(verd_crua = case_when(verd_crua== 1 ~ "Mai",
                               verd_crua== 2 ~ "3 o menys vegades a la setmana",
                               verd_crua== 3 ~ "3 o menys vegades a la setmana",
                               verd_crua== 4 ~ "Entre 4 i 6 vegades a la setmana",
                               verd_crua== 5 ~ "1 o 2 vegades al dia",
                               verd_crua== 6 ~ "1 o 2 vegades al dia",
                               verd_crua== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(verd_crua = factor(verd_crua, levels = c("Mai",
                                                  "3 o menys vegades a la setmana",
                                                  "Entre 4 i 6 vegades a la setmana",
                                                  "1 o 2 vegades al dia",
                                                  "3 o més vegades al dia"))) %>%
  mutate(verd_cuita = case_when(verd_cuita== 1 ~ "Mai",
                                verd_cuita== 2 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 3 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                                verd_cuita== 5 ~ "1 o 2 vegades al dia",
                                verd_cuita== 6 ~ "1 o 2 vegades al dia",
                                verd_cuita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(verd_cuita = factor(verd_cuita, levels = c("Mai",
                                                    "3 o menys vegades a la setmana",
                                                    "Entre 4 i 6 vegades a la setmana",
                                                    "1 o 2 vegades al dia",
                                                    "3 o més vegades al dia"))) %>%
  mutate(carn_verm = case_when(carn_verm== 1 ~ "Mai",
                               carn_verm== 2 ~ "3 o menys vegades al mes",
                               carn_verm== 3 ~ "3 o menys vegades al mes",
                               carn_verm== 4 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 5 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 6 ~ "Entre 3 i 6 vegades a la setmana",
                               carn_verm== 7 ~ "1 o més vegades al dia",)) %>%
  mutate(carn_verm = factor(carn_verm, levels = c("Mai",
                                                  "3 o menys vegades al mes",
                                                  "1 o 2 vegades a la setmana",
                                                  "Entre 3 i 6 vegades a la setmana",
                                                  "1 o més vegades al dia"))) %>%
  mutate(refresc = case_when(refresc== 1 ~ "Mai",
                             refresc== 2 ~ "Entre 1 i 3 vegades al mes",
                             refresc== 3 ~ "Entre 1 i 3 vegades a la setmana",
                             refresc== 4 ~ "Entre 4 i 6 vegades a la setmana",
                             refresc== 5 ~ "1 vegada al dia",
                             refresc== 6 ~ "2 o més vegades al dia",
                             refresc== 7 ~ "2 o més vegades al dia",)) %>%
  mutate(refresc = factor(refresc, levels = c("Mai",
                                              "Entre 1 i 3 vegades al mes",
                                              "Entre 1 i 3 vegades a la setmana",
                                              "Entre 4 i 6 vegades a la setmana",
                                              "1 vegada al dia",
                                              "2 o més vegades al dia"))) %>%
  mutate(menj_rapid = case_when(menj_rapid== 1 ~ "Mai",
                                menj_rapid== 2 ~ "1 vegada al mes",
                                menj_rapid== 3 ~ "2 o 3 vegades al mes",
                                menj_rapid== 4 ~ "1 o més vegades a la setmana",)) %>%
  mutate(menj_rapid = factor(menj_rapid, levels = c("Mai",
                                                    "1 vegada al mes",
                                                    "2 o 3 vegades al mes",
                                                    "1 o més vegades a la setmana"))) %>%
  mutate(esm_sort = case_when(esm_sort== 1 ~ "Cap vegada",
                              esm_sort== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              esm_sort== 3 ~ "Cada dia",
                              esm_sort== 4 ~ "No pertinent (no surt de casa)")) %>%
  mutate(esm_sort = factor(esm_sort, levels = c("Cap vegada",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Cada dia",
                                                "No pertinent (no surt de casa)"))) %>% 
  mutate(pant_sopar = case_when(pant_sopar== 1 ~ "Mai o gairebé mai",
                                pant_sopar== 2 ~ "A vegades",
                                pant_sopar== 3 ~ "Sempre o gairebé sempre")) %>%
  mutate(pant_sopar = factor(pant_sopar, levels = c("Mai o gairebé mai",
                                                    "A vegades",
                                                    "Sempre o gairebé sempre"))) %>%
  mutate(gana_r = case_when(gana_r== 3 ~ "Mai o gairebé mai",
                            gana_r== 2 ~ "A vegades",
                            gana_r== 1 ~ "Sempre o gairebé sempre")) %>%
  mutate(gana_r = factor(gana_r, levels = c("Mai o gairebé mai",
                                            "A vegades",
                                            "Sempre o gairebé sempre"))) %>%
  select(FAS_cat, verd_crua, verd_cuita, fruita, carn_verm, refresc, menj_rapid,
         esm_sort, dieta, pant_sopar, gana_r) %>%
  tbl_summary(by="FAS_cat",
              percent="column",
              statistic = list(all_continuous() ~ "{mean} ({sd})",        
                               all_categorical() ~ "{n} ({p}%)"),
              label  = list(verd_crua ~ "Verdura crua",
                            verd_cuita ~ "Verdura cuita",
                            fruita ~ "Fruita",
                            carn_verm ~ "Carn vermella",
                            refresc ~ "Begudes ensucrades",
                            menj_rapid ~ "Menjar ràpid",
                            esm_sort ~ "Esmorzar abans de sortir de casa",
                            dieta ~ "Dieta per aprimar-se",
                            pant_sopar ~ "Utilització de pantalles durant el sopar",
                            gana_r ~ "Ha anat al llit amb gana per falta de menjar a casa"),
              missing_text = "Desconegut"
  ) %>% 
  #add_n() %>% 
  add_p() %>%
  #add_overall() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_fresc_nse_d <- as_flex_table(taula_fresc_nse_d) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Nivell socioeconòmic³", "", "", "p-valor²")) %>% 
  merge_at(i = 1, j = 2:4, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 5, part = "header") %>%
  bold(i = 1:2, j = 1:5, part = "header") %>% 
  compose(i = 8, j = 5, part = "body",
          value = as_paragraph("<0.001")) %>% 
  bold(i = 8, j = 5, part = "body") %>%
  compose(i = 43, j = 5, part = "body",
          value = as_paragraph("0.120")) %>% 
  compose(i = 59, j = 5, part = "body",
          value = as_paragraph("0.003")) %>% 
  bold(i = 59, j = 5, part = "body") %>% 
  compose(i = 2, j = 1, part = "footer", 
          value = as_paragraph("²Pearson's Chi-squared test or Fisher's exact test")) %>% 
  footnote(i = 1, j = 3, ref_symbols = c(""), value = as_paragraph("³Hartley JE, Levin K, Currie C. A new version of the HBSC Family Affluence Scale - FAS III: Scottish Qualitative Findings from the International FAS Development Study. Child Indic Res. 2016;9:233-245. doi: 10.1007/s12187-015-9325-3. Epub 2015 Aug 2. PMID: 26925177; PMCID: PMC4757604.")) 

flextable_fresc_nse_d
```

#### Nois

```{r nse_h, echo=FALSE, message=FALSE, error=FALSE, warning=FALSE}
taula_fresc_nse_h <- fresc_21 %>%
  filter(sexe==2) %>% 
  mutate(FAS_cat = case_when(FAS_cat== 1 ~ "Baix", FAS_cat== 2 ~ "Mig",
                            FAS_cat== 3 ~ "Alt")) %>%
  mutate(FAS_cat = factor(FAS_cat, levels = c("Baix",
                                            "Mig",
                                            "Alt"))) %>%
  mutate(fruita = case_when(fruita== 1 ~ "Mai",
                            fruita== 2 ~ "3 o menys vegades a la setmana",
                            fruita== 3 ~ "3 o menys vegades a la setmana",
                            fruita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                            fruita== 5 ~ "1 o 2 vegades al dia",
                            fruita== 6 ~ "1 o 2 vegades al dia",
                            fruita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(fruita = factor(fruita, levels = c("Mai",
                                            "3 o menys vegades a la setmana",
                                            "Entre 4 i 6 vegades a la setmana",
                                            "1 o 2 vegades al dia",
                                            "3 o més vegades al dia"))) %>%
  mutate(verd_crua = case_when(verd_crua== 1 ~ "Mai",
                               verd_crua== 2 ~ "3 o menys vegades a la setmana",
                               verd_crua== 3 ~ "3 o menys vegades a la setmana",
                               verd_crua== 4 ~ "Entre 4 i 6 vegades a la setmana",
                               verd_crua== 5 ~ "1 o 2 vegades al dia",
                               verd_crua== 6 ~ "1 o 2 vegades al dia",
                               verd_crua== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(verd_crua = factor(verd_crua, levels = c("Mai",
                                                  "3 o menys vegades a la setmana",
                                                  "Entre 4 i 6 vegades a la setmana",
                                                  "1 o 2 vegades al dia",
                                                  "3 o més vegades al dia"))) %>%
  mutate(verd_cuita = case_when(verd_cuita== 1 ~ "Mai",
                                verd_cuita== 2 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 3 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                                verd_cuita== 5 ~ "1 o 2 vegades al dia",
                                verd_cuita== 6 ~ "1 o 2 vegades al dia",
                                verd_cuita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(verd_cuita = factor(verd_cuita, levels = c("Mai",
                                                    "3 o menys vegades a la setmana",
                                                    "Entre 4 i 6 vegades a la setmana",
                                                    "1 o 2 vegades al dia",
                                                    "3 o més vegades al dia"))) %>%
  mutate(carn_verm = case_when(carn_verm== 1 ~ "Mai",
                               carn_verm== 2 ~ "3 o menys vegades al mes",
                               carn_verm== 3 ~ "3 o menys vegades al mes",
                               carn_verm== 4 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 5 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 6 ~ "Entre 3 i 6 vegades a la setmana",
                               carn_verm== 7 ~ "1 o més vegades al dia",)) %>%
  mutate(carn_verm = factor(carn_verm, levels = c("Mai",
                                                  "3 o menys vegades al mes",
                                                  "1 o 2 vegades a la setmana",
                                                  "Entre 3 i 6 vegades a la setmana",
                                                  "1 o més vegades al dia"))) %>%
  mutate(refresc = case_when(refresc== 1 ~ "Mai",
                             refresc== 2 ~ "Entre 1 i 3 vegades al mes",
                             refresc== 3 ~ "Entre 1 i 3 vegades a la setmana",
                             refresc== 4 ~ "Entre 4 i 6 vegades a la setmana",
                             refresc== 5 ~ "1 vegada al dia",
                             refresc== 6 ~ "2 o més vegades al dia",
                             refresc== 7 ~ "2 o més vegades al dia",)) %>%
  mutate(refresc = factor(refresc, levels = c("Mai",
                                              "Entre 1 i 3 vegades al mes",
                                              "Entre 1 i 3 vegades a la setmana",
                                              "Entre 4 i 6 vegades a la setmana",
                                              "1 vegada al dia",
                                              "2 o més vegades al dia"))) %>%
  mutate(menj_rapid = case_when(menj_rapid== 1 ~ "Mai",
                                menj_rapid== 2 ~ "1 vegada al mes",
                                menj_rapid== 3 ~ "2 o 3 vegades al mes",
                                menj_rapid== 4 ~ "1 o més vegades a la setmana",)) %>%
  mutate(menj_rapid = factor(menj_rapid, levels = c("Mai",
                                                    "1 vegada al mes",
                                                    "2 o 3 vegades al mes",
                                                    "1 o més vegades a la setmana"))) %>%
  mutate(esm_sort = case_when(esm_sort== 1 ~ "Cap vegada",
                              esm_sort== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              esm_sort== 3 ~ "Cada dia",
                              esm_sort== 4 ~ "No pertinent (no surt de casa)")) %>%
  mutate(esm_sort = factor(esm_sort, levels = c("Cap vegada",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Cada dia",
                                                "No pertinent (no surt de casa)"))) %>% 
  mutate(pant_sopar = case_when(pant_sopar== 1 ~ "Mai o gairebé mai",
                                pant_sopar== 2 ~ "A vegades",
                                pant_sopar== 3 ~ "Sempre o gairebé sempre")) %>%
  mutate(pant_sopar = factor(pant_sopar, levels = c("Mai o gairebé mai",
                                                    "A vegades",
                                                    "Sempre o gairebé sempre"))) %>%
  mutate(gana_r = case_when(gana_r== 3 ~ "Mai o gairebé mai",
                            gana_r== 2 ~ "A vegades",
                            gana_r== 1 ~ "Sempre o gairebé sempre")) %>%
  mutate(gana_r = factor(gana_r, levels = c("Mai o gairebé mai",
                                            "A vegades",
                                            "Sempre o gairebé sempre"))) %>%
  select(FAS_cat, verd_crua, verd_cuita, fruita, carn_verm, refresc, menj_rapid,
         esm_sort, dieta, pant_sopar, gana_r) %>%
  tbl_summary(by="FAS_cat",
              percent="column",
              statistic = list(all_continuous() ~ "{mean} ({sd})",        
                               all_categorical() ~ "{n} ({p}%)"),
              label  = list(verd_crua ~ "Verdura crua",
                            verd_cuita ~ "Verdura cuita",
                            fruita ~ "Fruita",
                            carn_verm ~ "Carn vermella",
                            refresc ~ "Begudes ensucrades",
                            menj_rapid ~ "Menjar ràpid",
                            esm_sort ~ "Esmorzar abans de sortir de casa",
                            dieta ~ "Dieta per aprimar-se",
                            pant_sopar ~ "Utilització de pantalles durant el sopar",
                            gana_r ~ "Ha anat al llit amb gana per falta de menjar a casa"),
              missing_text = "Desconegut"
  ) %>% 
  #add_n() %>% 
  add_p() %>%
  #add_overall() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_fresc_nse_h <- as_flex_table(taula_fresc_nse_h) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Nivell socioeconòmic³", "", "", "p-valor²")) %>% 
  merge_at(i = 1, j = 2:4, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 5, part = "header") %>%
  bold(i = 1:2, j = 1:5, part = "header") %>% 
  compose(i = 43, j = 5, part = "body",
          value = as_paragraph("0.153")) %>% 
  compose(i = 2, j = 1, part = "footer", 
          value = as_paragraph("²Pearson's Chi-squared test or Fisher's exact test")) %>% 
  footnote(i = 1, j = 3, ref_symbols = c(""), value = as_paragraph("³Hartley JE, Levin K, Currie C. A new version of the HBSC Family Affluence Scale - FAS III: Scottish Qualitative Findings from the International FAS Development Study. Child Indic Res. 2016;9:233-245. doi: 10.1007/s12187-015-9325-3. Epub 2015 Aug 2. PMID: 26925177; PMCID: PMC4757604.")) 

flextable_fresc_nse_h
```

### Per lloc de naixement i per sexe {.tabset}

#### Noies

```{r pnaix_d, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
taula_fresc_pnaix_d <- fresc_21 %>%
  filter(sexe==1) %>% 
  mutate(pnaix_alumne = case_when(pnaix_alumne== 1 ~ "A Barcelona",
                                  pnaix_alumne== 2 ~ "A un altre municipi de Catalunya",
                                  pnaix_alumne== 3 ~ "A un altre municipi d'Espanya, fora de Catalunya",
                                  pnaix_alumne== 4 ~ "A l'estranger")) %>%
  mutate(pnaix_alumne = factor(pnaix_alumne, levels = c("A Barcelona",
                                              "A un altre municipi de Catalunya",
                                              "A un altre municipi d'Espanya, fora de Catalunya",
                                              "A l'estranger"))) %>%
  mutate(fruita = case_when(fruita== 1 ~ "Mai",
                            fruita== 2 ~ "3 o menys vegades a la setmana",
                            fruita== 3 ~ "3 o menys vegades a la setmana",
                            fruita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                            fruita== 5 ~ "1 o 2 vegades al dia",
                            fruita== 6 ~ "1 o 2 vegades al dia",
                            fruita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(fruita = factor(fruita, levels = c("Mai",
                                            "3 o menys vegades a la setmana",
                                            "Entre 4 i 6 vegades a la setmana",
                                            "1 o 2 vegades al dia",
                                            "3 o més vegades al dia"))) %>%
  mutate(verd_crua = case_when(verd_crua== 1 ~ "Mai",
                               verd_crua== 2 ~ "3 o menys vegades a la setmana",
                               verd_crua== 3 ~ "3 o menys vegades a la setmana",
                               verd_crua== 4 ~ "Entre 4 i 6 vegades a la setmana",
                               verd_crua== 5 ~ "1 o 2 vegades al dia",
                               verd_crua== 6 ~ "1 o 2 vegades al dia",
                               verd_crua== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(verd_crua = factor(verd_crua, levels = c("Mai",
                                                  "3 o menys vegades a la setmana",
                                                  "Entre 4 i 6 vegades a la setmana",
                                                  "1 o 2 vegades al dia",
                                                  "3 o més vegades al dia"))) %>%
  mutate(verd_cuita = case_when(verd_cuita== 1 ~ "Mai",
                                verd_cuita== 2 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 3 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                                verd_cuita== 5 ~ "1 o 2 vegades al dia",
                                verd_cuita== 6 ~ "1 o 2 vegades al dia",
                                verd_cuita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(verd_cuita = factor(verd_cuita, levels = c("Mai",
                                                    "3 o menys vegades a la setmana",
                                                    "Entre 4 i 6 vegades a la setmana",
                                                    "1 o 2 vegades al dia",
                                                    "3 o més vegades al dia"))) %>%
  mutate(carn_verm = case_when(carn_verm== 1 ~ "Mai",
                               carn_verm== 2 ~ "3 o menys vegades al mes",
                               carn_verm== 3 ~ "3 o menys vegades al mes",
                               carn_verm== 4 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 5 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 6 ~ "Entre 3 i 6 vegades a la setmana",
                               carn_verm== 7 ~ "1 o més vegades al dia",)) %>%
  mutate(carn_verm = factor(carn_verm, levels = c("Mai",
                                                  "3 o menys vegades al mes",
                                                  "1 o 2 vegades a la setmana",
                                                  "Entre 3 i 6 vegades a la setmana",
                                                  "1 o més vegades al dia"))) %>%
  mutate(refresc = case_when(refresc== 1 ~ "Mai",
                             refresc== 2 ~ "Entre 1 i 3 vegades al mes",
                             refresc== 3 ~ "Entre 1 i 3 vegades a la setmana",
                             refresc== 4 ~ "Entre 4 i 6 vegades a la setmana",
                             refresc== 5 ~ "1 vegada al dia",
                             refresc== 6 ~ "2 o més vegades al dia",
                             refresc== 7 ~ "2 o més vegades al dia",)) %>%
  mutate(refresc = factor(refresc, levels = c("Mai",
                                              "Entre 1 i 3 vegades al mes",
                                              "Entre 1 i 3 vegades a la setmana",
                                              "Entre 4 i 6 vegades a la setmana",
                                              "1 vegada al dia",
                                              "2 o més vegades al dia"))) %>%
  mutate(menj_rapid = case_when(menj_rapid== 1 ~ "Mai",
                                menj_rapid== 2 ~ "1 vegada al mes",
                                menj_rapid== 3 ~ "2 o 3 vegades al mes",
                                menj_rapid== 4 ~ "1 o més vegades a la setmana",)) %>%
  mutate(menj_rapid = factor(menj_rapid, levels = c("Mai",
                                                    "1 vegada al mes",
                                                    "2 o 3 vegades al mes",
                                                    "1 o més vegades a la setmana"))) %>%
  mutate(esm_sort = case_when(esm_sort== 1 ~ "Cap vegada",
                              esm_sort== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              esm_sort== 3 ~ "Cada dia",
                              esm_sort== 4 ~ "No pertinent (no surt de casa)")) %>%
  mutate(esm_sort = factor(esm_sort, levels = c("Cap vegada",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Cada dia",
                                                "No pertinent (no surt de casa)"))) %>% 
  mutate(pant_sopar = case_when(pant_sopar== 1 ~ "Mai o gairebé mai",
                                pant_sopar== 2 ~ "A vegades",
                                pant_sopar== 3 ~ "Sempre o gairebé sempre")) %>%
  mutate(pant_sopar = factor(pant_sopar, levels = c("Mai o gairebé mai",
                                                    "A vegades",
                                                    "Sempre o gairebé sempre"))) %>%
  mutate(gana_r = case_when(gana_r== 3 ~ "Mai o gairebé mai",
                            gana_r== 2 ~ "A vegades",
                            gana_r== 1 ~ "Sempre o gairebé sempre")) %>%
  mutate(gana_r = factor(gana_r, levels = c("Mai o gairebé mai",
                                            "A vegades",
                                            "Sempre o gairebé sempre"))) %>%
  select(pnaix_alumne, verd_crua, verd_cuita, fruita, carn_verm, refresc, menj_rapid,
         esm_sort, dieta, pant_sopar, gana_r) %>%
  tbl_summary(by="pnaix_alumne",
              percent="column",
              statistic = list(all_continuous() ~ "{mean} ({sd})",        
                               all_categorical() ~ "{n} ({p}%)"),
              label  = list(verd_crua ~ "Verdura crua",
                            verd_cuita ~ "Verdura cuita",
                            fruita ~ "Fruita",
                            carn_verm ~ "Carn vermella",
                            refresc ~ "Begudes ensucrades",
                            menj_rapid ~ "Menjar ràpid",
                            esm_sort ~ "Esmorzar abans de sortir de casa",
                            dieta ~ "Dieta per aprimar-se",
                            pant_sopar ~ "Utilització de pantalles durant el sopar",
                            gana_r ~ "Ha anat al llit amb gana per falta de menjar a casa"),
              missing_text = "Desconegut"
  ) %>% 
  #add_n() %>% 
  add_p() %>%
  #add_overall() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_fresc_pnaix_d <- as_flex_table(taula_fresc_pnaix_d) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Lloc de naixement", "", "", "", "p-valor²")) %>% 
  merge_at(i = 1, j = 2:5, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 6, part = "header") %>%
  bold(i = 1:2, j = 1:6, part = "header") %>% 
  compose(i = 1, j = 6, part = "body",
        value = as_paragraph("0.031")) %>% 
  bold(i = 1, j = 6, part = "body") %>%
  compose(i = 8, j = 6, part = "body",
          value = as_paragraph("0.002")) %>% 
  bold(i = 8, j = 6, part = "body") %>%
  compose(i = 15, j = 6, part = "body",
          value = as_paragraph("0.028")) %>% 
  bold(i = 15, j = 6, part = "body") %>%
  compose(i = 22, j = 6, part = "body",
          value = as_paragraph("0.090")) %>% 
  bold(i = 22, j = 6, part = "body") %>%
  compose(i = 29, j = 6, part = "body",
          value = as_paragraph("<0.001")) %>% 
  bold(i = 29, j = 6, part = "body") %>%
  compose(i = 37, j = 6, part = "body",
          value = as_paragraph("0.245")) %>% 
  compose(i = 43, j = 6, part = "body",
          value = as_paragraph("0.267")) %>% 
  compose(i = 49, j = 6, part = "body",
          value = as_paragraph("0.003")) %>% 
  bold(i = 49, j = 6, part = "body") %>% 
  compose(i = 59, j = 6, part = "body",
          value = as_paragraph("0.022")) %>% 
  bold(i = 59, j = 6, part = "body") %>% 
  compose(i = 2, j = 1, part = "footer", 
          value = as_paragraph("²Pearson's Chi-squared test or Fisher's exact test"))

flextable_fresc_pnaix_d
```

#### Nois

```{r pnaix_h, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
taula_fresc_pnaix_h <- fresc_21 %>%
  filter(sexe==2) %>% 
  mutate(pnaix_alumne = case_when(pnaix_alumne== 1 ~ "A Barcelona",
                                  pnaix_alumne== 2 ~ "A un altre municipi de Catalunya",
                                  pnaix_alumne== 3 ~ "A un altre municipi d'Espanya, fora de Catalunya",
                                  pnaix_alumne== 4 ~ "A l'estranger")) %>%
  mutate(pnaix_alumne = factor(pnaix_alumne, levels = c("A Barcelona",
                                              "A un altre municipi de Catalunya",
                                              "A un altre municipi d'Espanya, fora de Catalunya",
                                              "A l'estranger"))) %>%
  mutate(fruita = case_when(fruita== 1 ~ "Mai",
                            fruita== 2 ~ "3 o menys vegades a la setmana",
                            fruita== 3 ~ "3 o menys vegades a la setmana",
                            fruita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                            fruita== 5 ~ "1 o 2 vegades al dia",
                            fruita== 6 ~ "1 o 2 vegades al dia",
                            fruita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(fruita = factor(fruita, levels = c("Mai",
                                            "3 o menys vegades a la setmana",
                                            "Entre 4 i 6 vegades a la setmana",
                                            "1 o 2 vegades al dia",
                                            "3 o més vegades al dia"))) %>%
  mutate(verd_crua = case_when(verd_crua== 1 ~ "Mai",
                               verd_crua== 2 ~ "3 o menys vegades a la setmana",
                               verd_crua== 3 ~ "3 o menys vegades a la setmana",
                               verd_crua== 4 ~ "Entre 4 i 6 vegades a la setmana",
                               verd_crua== 5 ~ "1 o 2 vegades al dia",
                               verd_crua== 6 ~ "1 o 2 vegades al dia",
                               verd_crua== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(verd_crua = factor(verd_crua, levels = c("Mai",
                                                  "3 o menys vegades a la setmana",
                                                  "Entre 4 i 6 vegades a la setmana",
                                                  "1 o 2 vegades al dia",
                                                  "3 o més vegades al dia"))) %>%
  mutate(verd_cuita = case_when(verd_cuita== 1 ~ "Mai",
                                verd_cuita== 2 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 3 ~ "3 o menys vegades a la setmana",
                                verd_cuita== 4 ~ "Entre 4 i 6 vegades a la setmana",
                                verd_cuita== 5 ~ "1 o 2 vegades al dia",
                                verd_cuita== 6 ~ "1 o 2 vegades al dia",
                                verd_cuita== 7 ~ "3 o més vegades al dia",)) %>%
  mutate(verd_cuita = factor(verd_cuita, levels = c("Mai",
                                                    "3 o menys vegades a la setmana",
                                                    "Entre 4 i 6 vegades a la setmana",
                                                    "1 o 2 vegades al dia",
                                                    "3 o més vegades al dia"))) %>%
  mutate(carn_verm = case_when(carn_verm== 1 ~ "Mai",
                               carn_verm== 2 ~ "3 o menys vegades al mes",
                               carn_verm== 3 ~ "3 o menys vegades al mes",
                               carn_verm== 4 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 5 ~ "1 o 2 vegades a la setmana",
                               carn_verm== 6 ~ "Entre 3 i 6 vegades a la setmana",
                               carn_verm== 7 ~ "1 o més vegades al dia",)) %>%
  mutate(carn_verm = factor(carn_verm, levels = c("Mai",
                                                  "3 o menys vegades al mes",
                                                  "1 o 2 vegades a la setmana",
                                                  "Entre 3 i 6 vegades a la setmana",
                                                  "1 o més vegades al dia"))) %>%
  mutate(refresc = case_when(refresc== 1 ~ "Mai",
                             refresc== 2 ~ "Entre 1 i 3 vegades al mes",
                             refresc== 3 ~ "Entre 1 i 3 vegades a la setmana",
                             refresc== 4 ~ "Entre 4 i 6 vegades a la setmana",
                             refresc== 5 ~ "1 vegada al dia",
                             refresc== 6 ~ "2 o més vegades al dia",
                             refresc== 7 ~ "2 o més vegades al dia",)) %>%
  mutate(refresc = factor(refresc, levels = c("Mai",
                                              "Entre 1 i 3 vegades al mes",
                                              "Entre 1 i 3 vegades a la setmana",
                                              "Entre 4 i 6 vegades a la setmana",
                                              "1 vegada al dia",
                                              "2 o més vegades al dia"))) %>%
  mutate(menj_rapid = case_when(menj_rapid== 1 ~ "Mai",
                                menj_rapid== 2 ~ "1 vegada al mes",
                                menj_rapid== 3 ~ "2 o 3 vegades al mes",
                                menj_rapid== 4 ~ "1 o més vegades a la setmana",)) %>%
  mutate(menj_rapid = factor(menj_rapid, levels = c("Mai",
                                                    "1 vegada al mes",
                                                    "2 o 3 vegades al mes",
                                                    "1 o més vegades a la setmana"))) %>%
  mutate(esm_sort = case_when(esm_sort== 1 ~ "Cap vegada",
                              esm_sort== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              esm_sort== 3 ~ "Cada dia",
                              esm_sort== 4 ~ "No pertinent (no surt de casa)")) %>%
  mutate(esm_sort = factor(esm_sort, levels = c("Cap vegada",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Cada dia",
                                                "No pertinent (no surt de casa)"))) %>% 
  mutate(pant_sopar = case_when(pant_sopar== 1 ~ "Mai o gairebé mai",
                                pant_sopar== 2 ~ "A vegades",
                                pant_sopar== 3 ~ "Sempre o gairebé sempre")) %>%
  mutate(pant_sopar = factor(pant_sopar, levels = c("Mai o gairebé mai",
                                                    "A vegades",
                                                    "Sempre o gairebé sempre"))) %>%
  mutate(gana_r = case_when(gana_r== 3 ~ "Mai o gairebé mai",
                            gana_r== 2 ~ "A vegades",
                            gana_r== 1 ~ "Sempre o gairebé sempre")) %>%
  mutate(gana_r = factor(gana_r, levels = c("Mai o gairebé mai",
                                            "A vegades",
                                            "Sempre o gairebé sempre"))) %>%
  select(pnaix_alumne, verd_crua, verd_cuita, fruita, carn_verm, refresc, menj_rapid,
         esm_sort, dieta, pant_sopar, gana_r) %>%
  tbl_summary(by="pnaix_alumne",
              percent="column",
              statistic = list(all_continuous() ~ "{mean} ({sd})",        
                               all_categorical() ~ "{n} ({p}%)"),
              label  = list(verd_crua ~ "Verdura crua",
                            verd_cuita ~ "Verdura cuita",
                            fruita ~ "Fruita",
                            carn_verm ~ "Carn vermella",
                            refresc ~ "Begudes ensucrades",
                            menj_rapid ~ "Menjar ràpid",
                            esm_sort ~ "Esmorzar abans de sortir de casa",
                            dieta ~ "Dieta per aprimar-se",
                            pant_sopar ~ "Utilització de pantalles durant el sopar",
                            gana_r ~ "Ha anat al llit amb gana per falta de menjar a casa"),
              missing_text = "Desconegut"
  ) %>% 
  #add_n() %>% 
  add_p() %>%
  #add_overall() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_fresc_pnaix_h <- as_flex_table(taula_fresc_pnaix_h) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Lloc de naixement", "", "", "", "p-valor²")) %>% 
  merge_at(i = 1, j = 2:5, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 6, part = "header") %>%
  bold(i = 1:2, j = 1:6, part = "header") %>% 
  compose(i = 1, j = 6, part = "body",
        value = as_paragraph("0.015")) %>% 
  bold(i = 1, j = 6, part = "body") %>%
  compose(i = 8, j = 6, part = "body",
          value = as_paragraph("0.001")) %>% 
  bold(i = 8, j = 6, part = "body") %>%
  compose(i = 15, j = 6, part = "body",
          value = as_paragraph("0.026")) %>% 
  bold(i = 15, j = 6, part = "body") %>%
  compose(i = 22, j = 6, part = "body",
          value = as_paragraph("0.001")) %>% 
  bold(i = 22, j = 6, part = "body") %>%
  compose(i = 29, j = 6, part = "body",
          value = as_paragraph("0.030")) %>% 
  bold(i = 29, j = 6, part = "body") %>%
  compose(i = 37, j = 6, part = "body",
          value = as_paragraph("0.401")) %>% 
  compose(i = 43, j = 6, part = "body",
          value = as_paragraph("0.369")) %>% 
  compose(i = 49, j = 6, part = "body",
          value = as_paragraph("0.424")) %>% 
  compose(i = 59, j = 6, part = "body",
          value = as_paragraph("0.236")) %>% 
  compose(i = 2, j = 1, part = "footer", 
          value = as_paragraph("²Pearson's Chi-squared test or Fisher's exact test"))

flextable_fresc_pnaix_h
```

## Enquesta de Salut de Barcelona {.tabset}

```{r debug_esb, include=FALSE, echo=FALSE}
library(haven)
library(dplyr)
library(tidyverse)
library(summarytools)
library(pastecs)
library(crosstable)
library(expss)
library(gtsummary)
library(tidyverse)
library(flextable)
library(officer)
library(naniar)
library(flextable)
library(srvyr)
library(survey)

#### cargar el archivo .dta en R. Hay que poner la ruta entre comillas ("") ####
esb_21 <- read_dta("//aspblfs/usuaris$/ext_jmolero/Escritorio/Alimentació BCN/ESB/esb2021treb.dta")

#### survey design object ####
dadesev <- esb_21 %>%
  #filter(SEXE == 1) %>% 
  as_survey_design(1, strata = NULL, weight = PONDERA) #%>%
  #filter(!is.na(EDATB))
```

### Característiques sociodemogràfiques

```{r sociodemog_esb, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
esb_sociodem <- dadesev %>% 
  mutate(SEXE = case_when(SEXE==1 ~ "Home", SEXE==2 ~ "Dona")) %>% 
  mutate(DISTR = case_when(DISTR== 1 ~ "Ciutat Vella",
                           DISTR== 2 ~ "Eixample",
                           DISTR== 3 ~ "Sants-Montuïc",
                           DISTR== 4 ~ "Les Corts",
                           DISTR== 5 ~ "Sarrià-Sant Gervasi",
                           DISTR== 6 ~ "Gràcia",
                           DISTR== 7 ~ "Horta-Guinardó",
                           DISTR== 8 ~ "Nou Barris",
                           DISTR== 9 ~ "Sant Andreu",
                           DISTR== 10 ~ "Sant Martí")) %>% 
  mutate(DISTR = factor(DISTR, levels = c("Ciutat Vella",
                                          "Eixample",
                                          "Sants-Montuïc",
                                          "Les Corts",
                                          "Sarrià-Sant Gervasi",
                                          "Gràcia",
                                          "Horta-Guinardó",
                                          "Nou Barris",
                                          "Sant Andreu",
                                          "Sant Martí"))) %>%
  mutate(EDAT_OCUP = case_when(EDAT_OCUP== 0 ~ "0 - 15 anys",
                               EDAT_OCUP== 1 ~ "16 - 29 anys",
                               EDAT_OCUP== 2 ~ "30 - 44 anys",
                               EDAT_OCUP== 3 ~ "45 - 64 anys",
                               EDAT_OCUP== 4 ~ "65 anys o més")) %>% 
  mutate(EDAT_OCUP = factor(EDAT_OCUP, levels = c("0 - 15 anys",
                                                  "16 - 29 anys",
                                                  "30 - 44 anys",
                                                  "45 - 64 anys",
                                                  "65 anys o més"))) %>%
  mutate(CS5PR = case_when(CS5PR== 1 ~ "I",
                           CS5PR== 2 ~ "II",
                           CS5PR== 3 ~ "III",
                           CS5PR== 4 ~ "IV",
                           CS5PR== 5 ~ "V")) %>% 
  mutate(CS5PR = factor(CS5PR, levels = c("I",
                                          "II",
                                          "III",
                                          "IV",
                                          "V"))) %>%
  mutate(PNAIX = case_when(PNAIX== 1 ~ "Catalunya",
                           PNAIX== 2 ~ "Resta de l'Estat espanyol",
                           PNAIX== 3 ~ "Altres països de renda alta",
                           PNAIX== 4 ~ "Altres països de renda baixa")) %>% 
  mutate(PNAIX = factor(PNAIX, levels = c("Catalunya",
                                          "Resta de l'Estat espanyol",
                                          "Altres països de renda alta",
                                          "Altres països de renda baixa"))) %>%
  tbl_svysummary(include = c(SEXE, DISTR, EDAT_OCUP, CS5PR, PNAIX),
                 statistic = list(everything() ~ c("{n} ({p}%)")),
                 label = list(SEXE ~ "Sexe",
                              DISTR ~ "Districte",
                              EDAT_OCUP ~ "Grup d'edat",
                              CS5PR ~ "Classe social²",
                              PNAIX ~ "Lloc de naixement"),
                 missing_text = "Desconegut") %>% 
  italicize_levels() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_esb_sociodem <- as_flex_table(esb_sociodem) %>% 
  autofit() %>% 
  bold(i = 1, j = 1:2, part = "header") %>% 
  footnote(i = 1, j = 2, ref_symbols = c(""), value = as_paragraph("²Regidor, Enrique. La clasificación de clase social de Goldthorpe: marco de referencia para la propuesta de medición de la clase social del grupo de trabajo de la Sociedad Española de Epidemiología. Rev. Esp. Salud Publica  [Internet]. 2001  Feb [citat  2022  Maig  17]; 75(1): 00-00. Disponible en: http://scielo.isciii.es/scielo.php?script=sci_arttext&pid=S1135-57272001000100003&lng=es.")) 

flextable_esb_sociodem
```

### Total

```{r general_esb, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
esb_general <- dadesev %>% 
  mutate(AM73_2 = case_when(AM73_2== 0 ~ "Mai",
                            AM73_2== 1 ~ "3 vegades al mes o menys",
                            AM73_2== 2 ~ "3 vegades al mes o menys",
                            AM73_2== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_2== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_2 = factor(AM73_2, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_3 = case_when(AM73_3== 0 ~ "Mai",
                            AM73_3== 1 ~ "3 vegades al mes o menys",
                            AM73_3== 2 ~ "3 vegades al mes o menys",
                            AM73_3== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_3== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_3 = factor(AM73_3, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_1 = case_when(AM73_1== 0 ~ "Mai",
                            AM73_1== 1 ~ "3 vegades al mes o menys",
                            AM73_1== 2 ~ "3 vegades al mes o menys",
                            AM73_1== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_1== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_1 = factor(AM73_1, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_4 = case_when(AM73_4== 0 ~ "Mai",
                            AM73_4== 1 ~ "3 vegades al mes o menys",
                            AM73_4== 2 ~ "3 vegades al mes o menys",
                            AM73_4== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_4== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_4 = factor(AM73_4, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_5 = case_when(AM73_5== 0 ~ "Mai",
                            AM73_5== 1 ~ "3 vegades al mes o menys",
                            AM73_5== 2 ~ "3 vegades al mes o menys",
                            AM73_5== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_5== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_5 = factor(AM73_5, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM72_1 = case_when(AM72_1== 1 ~ "Mai",
                              AM72_1== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              AM72_1== 3 ~ "Entre 4 i 6 vegades a la setmana",
                              AM72_1== 4 ~ "Cada dia")) %>%
  mutate(AM72_1 = factor(AM72_1, levels = c("Mai",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Entre 4 i 6 vegades a la setmana",
                                                "Cada dia"))) %>%
  mutate(AM75 = case_when(AM75== 3 ~ "Mai",
                          AM75== 2 ~ "A vegades",
                          AM75== 1 ~ "Sovint")) %>%
  mutate(AM75 = factor(AM75, levels = c("Mai",
                                        "A vegades",
                                        "Sovint"))) %>%
  tbl_svysummary(include = c(AM73_2, AM73_3, AM73_1, AM73_4, AM73_5, AM72_1, AM75),
                 statistic = list(everything() ~ c("{n} ({p}%)")),
                 label = list(AM73_2 ~ "Hortalisses i verdures",
                              AM73_3 ~ "Fruita",
                              AM73_1 ~ "Carn vermella",
                              AM73_4 ~ "Begudes ensucrades",
                              AM73_5 ~ "Brioixeria",
                              AM72_1 ~ "Esmorzar abans de sortir de casa",
                              AM75 ~ "Reduir racions de menjar o saltar-se algun àpat per manca de diners"),
                 missing_text = "Desconegut") %>% 
  italicize_levels() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_esb <- as_flex_table(esb_general) %>% 
  autofit() %>% 
  bold(i = 1, j = 1:2, part = "header")

flextable_esb
```

### Per sexe

```{r esb_sexe, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
esb_sexe <- dadesev %>% 
  mutate(SEXE = case_when(SEXE==1 ~ "Home", SEXE==2 ~ "Dona")) %>% 
  mutate(AM73_2 = case_when(AM73_2== 0 ~ "Mai",
                            AM73_2== 1 ~ "3 vegades al mes o menys",
                            AM73_2== 2 ~ "3 vegades al mes o menys",
                            AM73_2== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_2== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_2 = factor(AM73_2, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_3 = case_when(AM73_3== 0 ~ "Mai",
                            AM73_3== 1 ~ "3 vegades al mes o menys",
                            AM73_3== 2 ~ "3 vegades al mes o menys",
                            AM73_3== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_3== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_3 = factor(AM73_3, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_1 = case_when(AM73_1== 0 ~ "Mai",
                            AM73_1== 1 ~ "3 vegades al mes o menys",
                            AM73_1== 2 ~ "3 vegades al mes o menys",
                            AM73_1== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_1== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_1 = factor(AM73_1, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_4 = case_when(AM73_4== 0 ~ "Mai",
                            AM73_4== 1 ~ "3 vegades al mes o menys",
                            AM73_4== 2 ~ "3 vegades al mes o menys",
                            AM73_4== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_4== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_4 = factor(AM73_4, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_5 = case_when(AM73_5== 0 ~ "Mai",
                            AM73_5== 1 ~ "3 vegades al mes o menys",
                            AM73_5== 2 ~ "3 vegades al mes o menys",
                            AM73_5== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_5== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_5 = factor(AM73_5, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM72_1 = case_when(AM72_1== 1 ~ "Mai",
                              AM72_1== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              AM72_1== 3 ~ "Entre 4 i 6 vegades a la setmana",
                              AM72_1== 4 ~ "Cada dia")) %>%
  mutate(AM72_1 = factor(AM72_1, levels = c("Mai",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Entre 4 i 6 vegades a la setmana",
                                                "Cada dia"))) %>%
  mutate(AM75 = case_when(AM75== 3 ~ "Mai",
                          AM75== 2 ~ "A vegades",
                          AM75== 1 ~ "Sovint")) %>%
  mutate(AM75 = factor(AM75, levels = c("Mai",
                                        "A vegades",
                                        "Sovint"))) %>%
  tbl_svysummary(by = "SEXE",
                 include = c(AM73_2, AM73_3, AM73_1, AM73_4, AM73_5, AM72_1, AM75),
                 statistic = list(everything() ~ c("{n} ({p}%)")),
                 label = list(AM73_2 ~ "Hortalisses i verdures",
                              AM73_3 ~ "Fruita",
                              AM73_1 ~ "Carn vermella",
                              AM73_4 ~ "Begudes ensucrades",
                              AM73_5 ~ "Brioixeria",
                              AM72_1 ~ "Esmorzar abans de sortir de casa",
                              AM75 ~ "Reduir racions de menjar o saltar-se algun àpat per manca de diners"),
                 missing_text = "Desconegut") %>% 
  add_p() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_esb_sexe <- as_flex_table(esb_sexe) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Sexe", "", "p-valor²")) %>% 
  merge_at(i = 1, j = 2:3, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 4, part = "header") %>%
  bold(i = 1:2, j = 1:4, part = "header")

flextable_esb_sexe
```

### Per districte i per sexe {.tabset}

#### Dones

```{r esb_districte_d, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
esb_distr_d <- dadesev %>% 
  filter(SEXE==2) %>% 
  mutate(DISTR = case_when(DISTR== 1 ~ "Ciutat Vella",
                           DISTR== 2 ~ "Eixample",
                           DISTR== 3 ~ "Sants-Montuïc",
                           DISTR== 4 ~ "Les Corts",
                           DISTR== 5 ~ "Sarrià-Sant Gervasi",
                           DISTR== 6 ~ "Gràcia",
                           DISTR== 7 ~ "Horta-Guinardó",
                           DISTR== 8 ~ "Nou Barris",
                           DISTR== 9 ~ "Sant Andreu",
                           DISTR== 10 ~ "Sant Martí")) %>% 
  mutate(DISTR = factor(DISTR, levels = c("Ciutat Vella",
                                          "Eixample",
                                          "Sants-Montuïc",
                                          "Les Corts",
                                          "Sarrià-Sant Gervasi",
                                          "Gràcia",
                                          "Horta-Guinardó",
                                          "Nou Barris",
                                          "Sant Andreu",
                                          "Sant Martí"))) %>%
  mutate(AM73_2 = case_when(AM73_2== 0 ~ "Mai",
                            AM73_2== 1 ~ "3 vegades al mes o menys",
                            AM73_2== 2 ~ "3 vegades al mes o menys",
                            AM73_2== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_2== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_2 = factor(AM73_2, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_3 = case_when(AM73_3== 0 ~ "Mai",
                            AM73_3== 1 ~ "3 vegades al mes o menys",
                            AM73_3== 2 ~ "3 vegades al mes o menys",
                            AM73_3== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_3== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_3 = factor(AM73_3, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_1 = case_when(AM73_1== 0 ~ "Mai",
                            AM73_1== 1 ~ "3 vegades al mes o menys",
                            AM73_1== 2 ~ "3 vegades al mes o menys",
                            AM73_1== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_1== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_1 = factor(AM73_1, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_4 = case_when(AM73_4== 0 ~ "Mai",
                            AM73_4== 1 ~ "3 vegades al mes o menys",
                            AM73_4== 2 ~ "3 vegades al mes o menys",
                            AM73_4== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_4== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_4 = factor(AM73_4, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_5 = case_when(AM73_5== 0 ~ "Mai",
                            AM73_5== 1 ~ "3 vegades al mes o menys",
                            AM73_5== 2 ~ "3 vegades al mes o menys",
                            AM73_5== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_5== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_5 = factor(AM73_5, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM72_1 = case_when(AM72_1== 1 ~ "Mai",
                              AM72_1== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              AM72_1== 3 ~ "Entre 4 i 6 vegades a la setmana",
                              AM72_1== 4 ~ "Cada dia")) %>%
  mutate(AM72_1 = factor(AM72_1, levels = c("Mai",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Entre 4 i 6 vegades a la setmana",
                                                "Cada dia"))) %>%
  mutate(AM75 = case_when(AM75== 3 ~ "Mai",
                          AM75== 2 ~ "A vegades",
                          AM75== 1 ~ "Sovint")) %>%
  mutate(AM75 = factor(AM75, levels = c("Mai",
                                        "A vegades",
                                        "Sovint"))) %>%
  tbl_svysummary(by = "DISTR",
                 include = c(AM73_2, AM73_3, AM73_1, AM73_4, AM73_5, AM72_1, AM75),
                 statistic = list(everything() ~ c("{n} ({p}%)")),
                 label = list(AM73_2 ~ "Hortalisses i verdures",
                              AM73_3 ~ "Fruita",
                              AM73_1 ~ "Carn vermella",
                              AM73_4 ~ "Begudes ensucrades",
                              AM73_5 ~ "Brioixeria",
                              AM72_1 ~ "Esmorzar abans de sortir de casa",
                              AM75 ~ "Reduir racions de menjar o saltar-se algun àpat per manca de diners"),
                 missing_text = "Desconegut") %>% 
  add_p() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_esb_districte_d <- as_flex_table(esb_distr_d) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Districte", "", "", "", "",
                                     "", "", "", "", "", "p-valor²")) %>% 
  merge_at(i = 1, j = 2:11, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 12, part = "header") %>%
  bold(i = 1:2, j = 1:12, part = "header")

flextable_esb_districte_d
```

#### Homes

```{r esb_districte_h, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
esb_distr_h <- dadesev %>% 
  filter(SEXE==1) %>% 
  mutate(DISTR = case_when(DISTR== 1 ~ "Ciutat Vella",
                           DISTR== 2 ~ "Eixample",
                           DISTR== 3 ~ "Sants-Montuïc",
                           DISTR== 4 ~ "Les Corts",
                           DISTR== 5 ~ "Sarrià-Sant Gervasi",
                           DISTR== 6 ~ "Gràcia",
                           DISTR== 7 ~ "Horta-Guinardó",
                           DISTR== 8 ~ "Nou Barris",
                           DISTR== 9 ~ "Sant Andreu",
                           DISTR== 10 ~ "Sant Martí")) %>% 
  mutate(DISTR = factor(DISTR, levels = c("Ciutat Vella",
                                          "Eixample",
                                          "Sants-Montuïc",
                                          "Les Corts",
                                          "Sarrià-Sant Gervasi",
                                          "Gràcia",
                                          "Horta-Guinardó",
                                          "Nou Barris",
                                          "Sant Andreu",
                                          "Sant Martí"))) %>%
  mutate(AM73_2 = case_when(AM73_2== 0 ~ "Mai",
                            AM73_2== 1 ~ "3 vegades al mes o menys",
                            AM73_2== 2 ~ "3 vegades al mes o menys",
                            AM73_2== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_2== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_2 = factor(AM73_2, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_3 = case_when(AM73_3== 0 ~ "Mai",
                            AM73_3== 1 ~ "3 vegades al mes o menys",
                            AM73_3== 2 ~ "3 vegades al mes o menys",
                            AM73_3== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_3== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_3 = factor(AM73_3, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_1 = case_when(AM73_1== 0 ~ "Mai",
                            AM73_1== 1 ~ "3 vegades al mes o menys",
                            AM73_1== 2 ~ "3 vegades al mes o menys",
                            AM73_1== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_1== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_1 = factor(AM73_1, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_4 = case_when(AM73_4== 0 ~ "Mai",
                            AM73_4== 1 ~ "3 vegades al mes o menys",
                            AM73_4== 2 ~ "3 vegades al mes o menys",
                            AM73_4== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_4== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_4 = factor(AM73_4, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_5 = case_when(AM73_5== 0 ~ "Mai",
                            AM73_5== 1 ~ "3 vegades al mes o menys",
                            AM73_5== 2 ~ "3 vegades al mes o menys",
                            AM73_5== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_5== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_5 = factor(AM73_5, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM72_1 = case_when(AM72_1== 1 ~ "Mai",
                              AM72_1== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              AM72_1== 3 ~ "Entre 4 i 6 vegades a la setmana",
                              AM72_1== 4 ~ "Cada dia")) %>%
  mutate(AM72_1 = factor(AM72_1, levels = c("Mai",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Entre 4 i 6 vegades a la setmana",
                                                "Cada dia"))) %>%
  mutate(AM75 = case_when(AM75== 3 ~ "Mai",
                          AM75== 2 ~ "A vegades",
                          AM75== 1 ~ "Sovint")) %>%
  mutate(AM75 = factor(AM75, levels = c("Mai",
                                        "A vegades",
                                        "Sovint"))) %>%
  tbl_svysummary(by = "DISTR",
                 include = c(AM73_2, AM73_3, AM73_1, AM73_4, AM73_5, AM72_1, AM75),
                 statistic = list(everything() ~ c("{n} ({p}%)")),
                 label = list(AM73_2 ~ "Hortalisses i verdures",
                              AM73_3 ~ "Fruita",
                              AM73_1 ~ "Carn vermella",
                              AM73_4 ~ "Begudes ensucrades",
                              AM73_5 ~ "Brioixeria",
                              AM72_1 ~ "Esmorzar abans de sortir de casa",
                              AM75 ~ "Reduir racions de menjar o saltar-se algun àpat per manca de diners"),
                 missing_text = "Desconegut") %>% 
  add_p() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_esb_districte_h <- as_flex_table(esb_distr_h) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Districte", "", "", "", "",
                                     "", "", "", "", "", "p-valor²")) %>% 
  merge_at(i = 1, j = 2:11, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 12, part = "header") %>%
  bold(i = 1:2, j = 1:12, part = "header")

flextable_esb_districte_h
```

### Mapes per districtes i segons sexe {.tabset}

#### Hortalisses i verdures

```{r maps3esb, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}
library(rgdal)
library(foreign)
library(readxl)
library(Hmisc)
library(RColorBrewer)
library(dplyr)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

dadesev <- dadesev %>% 
  mutate(verd_crua_1=case_when(AM73_2==0 ~ 0, AM73_2==1 ~ 0,AM73_2==2 ~ 0,
                             AM73_2==3 ~ 0,AM73_2==4 ~ 0,AM73_2==5 ~ 0,
                            AM73_2==6 ~ 1))

df3 <- dadesev %>%
  filter(SEXE==2) %>% 
  group_by(DISTR) %>% 
  summarise(verd_crua_1 = sum(verd_crua_1, na.rm=TRUE), n=n())
  
df3$prop3 <- df3$verd_crua_1/df3$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df3, by.x="DISTRICTE",by.y="DISTR",all.x=TRUE,all.y=TRUE)

#Li dic que m'ha de fer quintils de les taxes
Cortes3 <- cut2(districtes$prop3, g=5, digits=5)
valores3 <- as.numeric(Cortes3)
mypalette3<-brewer.pal(5,"Blues")
fgs<-mypalette3[valores3]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de verdures una o més vegades al dia en dones", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes3), fill=mypalette3, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

dadesev <- dadesev %>% 
  mutate(verd_crua_1=case_when(AM73_2==0 ~ 0, AM73_2==1 ~ 0,AM73_2==2 ~ 0,
                             AM73_2==3 ~ 0,AM73_2==4 ~ 0,AM73_2==5 ~ 0,
                            AM73_2==6 ~ 1))

df3 <- dadesev %>%
  filter(SEXE==1) %>% 
  group_by(DISTR) %>% 
  summarise(verd_crua_1 = sum(verd_crua_1, na.rm=TRUE), n=n())
  
df3$prop3 <- df3$verd_crua_1/df3$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df3, by.x="DISTRICTE",by.y="DISTR",all.x=TRUE,all.y=TRUE)

#Li dic que m'ha de fer quintils de les taxes
Cortes3 <- cut2(districtes$prop3, g=5, digits=5)
valores3 <- as.numeric(Cortes3)
mypalette3<-brewer.pal(5,"Greens")
fgs<-mypalette3[valores3]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de verdures una o més vegades al dia en homes", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes3), fill=mypalette3, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

#### Fruita

```{r maps1esb, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

#crear la variable fruita més d'1 vegada al dia
dadesev <- dadesev %>% 
  mutate(fruita_1=case_when(AM73_3==1 ~ 0, AM73_3==2 ~ 0,AM73_3==3 ~ 0,
                             AM73_3==4 ~ 0,AM73_3==5 ~ 1,AM73_3==6 ~ 1,
                            AM73_3==7 ~ 1))

df1 <- dadesev %>% 
  filter(SEXE==2) %>% 
  group_by(DISTR) %>% 
  summarise(fruita_1 = sum(fruita_1, na.rm=TRUE), n=n())
  
df1$prop <- df1$fruita_1/df1$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df1, by.x="DISTRICTE",by.y="DISTR",all.x=TRUE,all.y=TRUE)

#df1$prop <- format(round(df1$prop, 2), nsmall = 2)

#df1$prop <- as.numeric(df1$prop)

#par(mar=c(1,1,1,1))
#Li dic que m'ha de fer quintils de les taxes
Cortes1 <- cut2(districtes$prop, g=5, digits=5)
valores1 <- as.numeric(Cortes1)
mypalette1<-brewer.pal(5,"Blues")
fgs<-mypalette1[valores1]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de fruita una o més vegades al dia en dones", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes1), fill=mypalette1, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

#crear la variable fruita més d'1 vegada al dia
dadesev <- dadesev %>% 
  mutate(fruita_1=case_when(AM73_3==1 ~ 0, AM73_3==2 ~ 0,AM73_3==3 ~ 0,
                             AM73_3==4 ~ 0,AM73_3==5 ~ 1,AM73_3==6 ~ 1,
                            AM73_3==7 ~ 1))

df1 <- dadesev %>% 
  filter(SEXE==1) %>% 
  group_by(DISTR) %>% 
  summarise(fruita_1 = sum(fruita_1, na.rm=TRUE), n=n())
  
df1$prop <- df1$fruita_1/df1$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df1, by.x="DISTRICTE",by.y="DISTR",all.x=TRUE,all.y=TRUE)

#df1$prop <- format(round(df1$prop, 2), nsmall = 2)

#df1$prop <- as.numeric(df1$prop)

#par(mar=c(1,1,1,1))
#Li dic que m'ha de fer quintils de les taxes
Cortes1 <- cut2(districtes$prop, g=5, digits=5)
valores1 <- as.numeric(Cortes1)
mypalette1<-brewer.pal(5,"Greens")
fgs<-mypalette1[valores1]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de fruita una o més vegades al dia en homes", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes1), fill=mypalette1, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

#### Carn vermella

```{r maps4esb, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

dadesev <- dadesev %>% 
  mutate(carn_verm_1=case_when(AM73_1==0 ~ 0, AM73_1==1 ~ 0,AM73_1==2 ~ 0,
                             AM73_1==3 ~ 0, AM73_1==4 ~ 0, AM73_1==5 ~ 1,
                             AM73_1==6 ~ 1))

df4 <- dadesev %>% 
  filter(SEXE==2) %>% 
  group_by(DISTR) %>% 
  summarise(carn_verm_1 = sum(carn_verm_1, na.rm=TRUE), n=n())
  
df4$prop4 <- df4$carn_verm_1/df4$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df4, by.x="DISTRICTE",by.y="DISTR",all.x=TRUE,all.y=TRUE)

Cortes4 <- cut2(districtes$prop4, g=5, digits=5)
valores4 <- as.numeric(Cortes4)
mypalette4<-brewer.pal(5,"Blues")
fgs<-mypalette4[valores4]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de carn vermella tres o més
      vegades a la setmana en dones", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes4), fill=mypalette4, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

dadesev <- dadesev %>% 
  mutate(carn_verm_1=case_when(AM73_1==0 ~ 0, AM73_1==1 ~ 0,AM73_1==2 ~ 0,
                             AM73_1==3 ~ 0, AM73_1==4 ~ 0, AM73_1==5 ~ 1,
                             AM73_1==6 ~ 1))

df4 <- dadesev %>% 
  filter(SEXE==1) %>% 
  group_by(DISTR) %>% 
  summarise(carn_verm_1 = sum(carn_verm_1, na.rm=TRUE), n=n())
  
df4$prop4 <- df4$carn_verm_1/df4$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df4, by.x="DISTRICTE",by.y="DISTR",all.x=TRUE,all.y=TRUE)

Cortes4 <- cut2(districtes$prop4, g=5, digits=5)
valores4 <- as.numeric(Cortes4)
mypalette4<-brewer.pal(5,"Greens")
fgs<-mypalette4[valores4]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de carn vermella tres o més
      vegades a la setmana en homes", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes4), fill=mypalette4, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

#### Begudes ensucrades

```{r maps5esb, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

dadesev <- dadesev %>% 
  mutate(refresc_1=case_when(AM73_4==0 ~ 0, AM73_4==1 ~ 0,AM73_4==2 ~ 1,
                             AM73_4==3 ~ 1, AM73_4==4 ~ 1, AM73_4==5 ~ 1,
                             AM73_4==6 ~ 1))

df5 <- dadesev %>% 
  filter(SEXE==2) %>% 
  group_by(DISTR) %>% 
  summarise(refresc_1 = sum(refresc_1, na.rm=TRUE), n=n())
  
df5$prop5 <- df5$refresc_1/df5$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df5, by.x="DISTRICTE",by.y="DISTR",all.x=TRUE,all.y=TRUE)
attributes(esb_21$AM73_4)
Cortes5 <- cut2(districtes$prop5, g=5, digits=5)
valores5 <- as.numeric(Cortes5)
mypalette5<-brewer.pal(5,"Blues")
fgs<-mypalette5[valores5]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de begudes ensucrades una o
      més vegades al mes en dones", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes5), fill=mypalette5, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

dadesev <- dadesev %>% 
  mutate(refresc_1=case_when(AM73_4==0 ~ 0, AM73_4==1 ~ 0,AM73_4==2 ~ 1,
                             AM73_4==3 ~ 1, AM73_4==4 ~ 1, AM73_4==5 ~ 1,
                             AM73_4==6 ~ 1))

df5 <- dadesev %>% 
  filter(SEXE==1) %>% 
  group_by(DISTR) %>% 
  summarise(refresc_1 = sum(refresc_1, na.rm=TRUE), n=n())
  
df5$prop5 <- df5$refresc_1/df5$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df5, by.x="DISTRICTE",by.y="DISTR",all.x=TRUE,all.y=TRUE)
attributes(esb_21$AM73_4)
Cortes5 <- cut2(districtes$prop5, g=5, digits=5)
valores5 <- as.numeric(Cortes5)
mypalette5<-brewer.pal(5,"Greens")
fgs<-mypalette5[valores5]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de begudes ensucrades una o
      més vegades al mes en homes", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes5), fill=mypalette5, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

#### Brioixeria

```{r maps6esb, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

dadesev <- dadesev %>% 
  mutate(menj_rapid_1=case_when(AM73_5==0 ~ 0, AM73_5==1 ~ 0,AM73_5==2 ~ 1,
                             AM73_5==3 ~ 1, AM73_5==4 ~ 1, AM73_5==5 ~ 1,
                             AM73_5==6 ~ 1))

df6 <- dadesev %>% 
  filter(SEXE==2) %>% 
  group_by(DISTR) %>% 
  summarise(menj_rapid_1 = sum(menj_rapid_1, na.rm=TRUE), n=n())
  
df6$prop6 <- df6$menj_rapid_1/df6$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df6, by.x="DISTRICTE",by.y="DISTR",all.x=TRUE,all.y=TRUE)

Cortes6 <- cut2(districtes$prop6, g=5, digits=5)
valores6 <- as.numeric(Cortes6)
mypalette6<-brewer.pal(5,"Blues")
fgs<-mypalette6[valores6]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de brioixeria una o més vegades al mes en dones", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes6), fill=mypalette6, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

dadesev <- dadesev %>% 
  mutate(menj_rapid_1=case_when(AM73_5==0 ~ 0, AM73_5==1 ~ 0,AM73_5==2 ~ 1,
                             AM73_5==3 ~ 1, AM73_5==4 ~ 1, AM73_5==5 ~ 1,
                             AM73_5==6 ~ 1))

df6 <- dadesev %>% 
  filter(SEXE==1) %>% 
  group_by(DISTR) %>% 
  summarise(menj_rapid_1 = sum(menj_rapid_1, na.rm=TRUE), n=n())
  
df6$prop6 <- df6$menj_rapid_1/df6$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df6, by.x="DISTRICTE",by.y="DISTR",all.x=TRUE,all.y=TRUE)

Cortes6 <- cut2(districtes$prop6, g=5, digits=5)
valores6 <- as.numeric(Cortes6)
mypalette6<-brewer.pal(5,"Greens")
fgs<-mypalette6[valores6]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Consum de brioixeria una o més vegades al mes en homes", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes6), fill=mypalette6, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

#### Esmorzar

```{r maps7esb, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

dadesev <- dadesev %>% 
  mutate(esmorzar_1=case_when(AM72_1==1 ~ 0, AM72_1==2 ~ 0,AM72_1==3 ~ 0,
                              AM72_1==4 ~ 1))

df7 <- dadesev %>% 
  filter(SEXE==2) %>% 
  group_by(DISTR) %>% 
  summarise(esmorzar_1 = sum(esmorzar_1, na.rm=TRUE), n=n())
  
df7$prop7 <- df7$esmorzar_1/df7$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df7, by.x="DISTRICTE",by.y="DISTR",all.x=TRUE,all.y=TRUE)

Cortes7 <- cut2(districtes$prop7, g=5, digits=5)
valores7 <- as.numeric(Cortes7)
mypalette7<-brewer.pal(5,"Blues")
fgs<-mypalette7[valores7]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Dones que esmorzen sempre abans de sortir de casa", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes7), fill=mypalette7, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

dadesev <- dadesev %>% 
  mutate(esmorzar_1=case_when(AM72_1==1 ~ 0, AM72_1==2 ~ 0,AM72_1==3 ~ 0,
                              AM72_1==4 ~ 1))

df7 <- dadesev %>% 
  filter(SEXE==1) %>% 
  group_by(DISTR) %>% 
  summarise(esmorzar_1 = sum(esmorzar_1, na.rm=TRUE), n=n())
  
df7$prop7 <- df7$esmorzar_1/df7$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df7, by.x="DISTRICTE",by.y="DISTR",all.x=TRUE,all.y=TRUE)

Cortes7 <- cut2(districtes$prop7, g=5, digits=5)
valores7 <- as.numeric(Cortes7)
mypalette7<-brewer.pal(5,"Greens")
fgs<-mypalette7[valores7]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Homes que esmorzen sempre abans de sortir de casa", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes7), fill=mypalette7, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

#### Inseguretat alimentària

```{r maps10esb, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE, fig.width=6, fig.height=6, fig.align="center"}

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

dadesev <- dadesev %>% 
  mutate(gana_r_1=case_when(AM75==1 ~ 1, AM75==2 ~ 1, 
                                AM75==3 ~ 0))

df10 <- dadesev %>% 
  filter(SEXE==2) %>% 
  group_by(DISTR) %>% 
  summarise(gana_r_1 = sum(gana_r_1, na.rm=TRUE), n=n())
  
df10$prop10 <- df10$gana_r_1/df10$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df10, by.x="DISTRICTE",by.y="DISTR",all.x=TRUE,all.y=TRUE)

Cortes10 <- cut2(districtes$prop10, g=5, digits=5)
valores10 <- as.numeric(Cortes10)
mypalette10<-brewer.pal(5,"Blues")
fgs<-mypalette10[valores10]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Dones que sovint o algunes vegades ha reduït racions de
      menjar o s'ha saltat algun àpat per manca de diners", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes10), fill=mypalette10, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)

districtes <- readOGR(dsn = "//aspblfs/usuaris$/ext_jmolero/Escritorio/districte", layer = "0301040100_Districtes_UNITATS_ADM")

dadesev <- dadesev %>% 
  mutate(gana_r_1=case_when(AM75==1 ~ 1, AM75==2 ~ 1, 
                                AM75==3 ~ 0))

df10 <- dadesev %>% 
  filter(SEXE==1) %>% 
  group_by(DISTR) %>% 
  summarise(gana_r_1 = sum(gana_r_1, na.rm=TRUE), n=n())
  
df10$prop10 <- df10$gana_r_1/df10$n

districtes$DISTRICTE <- as.numeric(districtes$DISTRICTE)

districtes <- merge(districtes, df10, by.x="DISTRICTE",by.y="DISTR",all.x=TRUE,all.y=TRUE)

Cortes10 <- cut2(districtes$prop10, g=5, digits=5)
valores10 <- as.numeric(Cortes10)
mypalette10<-brewer.pal(5,"Greens")
fgs<-mypalette10[valores10]
plot(districtes, col=fgs, border="grey", lwd=0.001, xlab="", ylab="", axes=F)
title("Homes que sovint o algunes vegades ha reduït racions de
      menjar o s'ha saltat algun àpat per manca de diners", sub = "", cex.main = 1.1, font.main= 2, col.main= "black", cex.sub = 0.90, font.sub = 3, col.sub = "black", line=0)
legend("bottomright", title="Proporció",legend=levels(Cortes10), fill=mypalette10, y.intersp=0.8, cex=0.8, bty="n", inset=0.05)
```

### Per grup d'edat i per sexe {.tabset}

#### Dones

```{r esb_edat_d, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
esb_edat_d <- dadesev %>% 
  filter(SEXE==2) %>% 
  mutate(EDAT_OCUP = case_when(EDAT_OCUP== 0 ~ "0 - 15 anys",
                               EDAT_OCUP== 1 ~ "16 - 29 anys",
                               EDAT_OCUP== 2 ~ "30 - 44 anys",
                               EDAT_OCUP== 3 ~ "45 - 64 anys",
                               EDAT_OCUP== 4 ~ "65 anys o més")) %>% 
  mutate(EDAT_OCUP = factor(EDAT_OCUP, levels = c("0 - 15 anys",
                                                  "16 - 29 anys",
                                                  "30 - 44 anys",
                                                  "45 - 64 anys",
                                                  "65 anys o més"))) %>%
  mutate(AM73_2 = case_when(AM73_2== 0 ~ "Mai",
                            AM73_2== 1 ~ "3 vegades al mes o menys",
                            AM73_2== 2 ~ "3 vegades al mes o menys",
                            AM73_2== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_2== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_2 = factor(AM73_2, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_3 = case_when(AM73_3== 0 ~ "Mai",
                            AM73_3== 1 ~ "3 vegades al mes o menys",
                            AM73_3== 2 ~ "3 vegades al mes o menys",
                            AM73_3== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_3== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_3 = factor(AM73_3, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_1 = case_when(AM73_1== 0 ~ "Mai",
                            AM73_1== 1 ~ "3 vegades al mes o menys",
                            AM73_1== 2 ~ "3 vegades al mes o menys",
                            AM73_1== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_1== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_1 = factor(AM73_1, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_4 = case_when(AM73_4== 0 ~ "Mai",
                            AM73_4== 1 ~ "3 vegades al mes o menys",
                            AM73_4== 2 ~ "3 vegades al mes o menys",
                            AM73_4== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_4== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_4 = factor(AM73_4, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_5 = case_when(AM73_5== 0 ~ "Mai",
                            AM73_5== 1 ~ "3 vegades al mes o menys",
                            AM73_5== 2 ~ "3 vegades al mes o menys",
                            AM73_5== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_5== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_5 = factor(AM73_5, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM72_1 = case_when(AM72_1== 1 ~ "Mai",
                              AM72_1== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              AM72_1== 3 ~ "Entre 4 i 6 vegades a la setmana",
                              AM72_1== 4 ~ "Cada dia")) %>%
  mutate(AM72_1 = factor(AM72_1, levels = c("Mai",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Entre 4 i 6 vegades a la setmana",
                                                "Cada dia"))) %>%
  mutate(AM75 = case_when(AM75== 3 ~ "Mai",
                          AM75== 2 ~ "A vegades",
                          AM75== 1 ~ "Sovint")) %>%
  mutate(AM75 = factor(AM75, levels = c("Mai",
                                        "A vegades",
                                        "Sovint"))) %>%
  tbl_svysummary(by = "EDAT_OCUP",
                 include = c(AM73_2, AM73_3, AM73_1, AM73_4, AM73_5, AM72_1, AM75),
                 statistic = list(everything() ~ c("{n} ({p}%)")),
                 label = list(AM73_2 ~ "Hortalisses i verdures",
                              AM73_3 ~ "Fruita",
                              AM73_1 ~ "Carn vermella",
                              AM73_4 ~ "Begudes ensucrades",
                              AM73_5 ~ "Brioixeria",
                              AM72_1 ~ "Esmorzar abans de sortir de casa",
                              AM75 ~ "Reduir racions de menjar o saltar-se algun àpat per manca de diners"),
                 missing_text = "Desconegut") %>% 
  add_p() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_esb_edat_d <- as_flex_table(esb_edat_d) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Grup d'edat", "", "", "", "",
                                     "p-valor²")) %>% 
  merge_at(i = 1, j = 2:6, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 7, part = "header") %>%
  bold(i = 1:2, j = 1:7, part = "header")

flextable_esb_edat_d
```

#### Homes

```{r esb_edat_h, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
esb_edat_h <- dadesev %>% 
  filter(SEXE==1) %>% 
  mutate(EDAT_OCUP = case_when(EDAT_OCUP== 0 ~ "0 - 15 anys",
                               EDAT_OCUP== 1 ~ "16 - 29 anys",
                               EDAT_OCUP== 2 ~ "30 - 44 anys",
                               EDAT_OCUP== 3 ~ "45 - 64 anys",
                               EDAT_OCUP== 4 ~ "65 anys o més")) %>% 
  mutate(EDAT_OCUP = factor(EDAT_OCUP, levels = c("0 - 15 anys",
                                                  "16 - 29 anys",
                                                  "30 - 44 anys",
                                                  "45 - 64 anys",
                                                  "65 anys o més"))) %>%
  mutate(AM73_2 = case_when(AM73_2== 0 ~ "Mai",
                            AM73_2== 1 ~ "3 vegades al mes o menys",
                            AM73_2== 2 ~ "3 vegades al mes o menys",
                            AM73_2== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_2== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_2 = factor(AM73_2, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_3 = case_when(AM73_3== 0 ~ "Mai",
                            AM73_3== 1 ~ "3 vegades al mes o menys",
                            AM73_3== 2 ~ "3 vegades al mes o menys",
                            AM73_3== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_3== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_3 = factor(AM73_3, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_1 = case_when(AM73_1== 0 ~ "Mai",
                            AM73_1== 1 ~ "3 vegades al mes o menys",
                            AM73_1== 2 ~ "3 vegades al mes o menys",
                            AM73_1== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_1== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_1 = factor(AM73_1, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_4 = case_when(AM73_4== 0 ~ "Mai",
                            AM73_4== 1 ~ "3 vegades al mes o menys",
                            AM73_4== 2 ~ "3 vegades al mes o menys",
                            AM73_4== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_4== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_4 = factor(AM73_4, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_5 = case_when(AM73_5== 0 ~ "Mai",
                            AM73_5== 1 ~ "3 vegades al mes o menys",
                            AM73_5== 2 ~ "3 vegades al mes o menys",
                            AM73_5== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_5== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_5 = factor(AM73_5, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM72_1 = case_when(AM72_1== 1 ~ "Mai",
                              AM72_1== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              AM72_1== 3 ~ "Entre 4 i 6 vegades a la setmana",
                              AM72_1== 4 ~ "Cada dia")) %>%
  mutate(AM72_1 = factor(AM72_1, levels = c("Mai",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Entre 4 i 6 vegades a la setmana",
                                                "Cada dia"))) %>%
  mutate(AM75 = case_when(AM75== 3 ~ "Mai",
                          AM75== 2 ~ "A vegades",
                          AM75== 1 ~ "Sovint")) %>%
  mutate(AM75 = factor(AM75, levels = c("Mai",
                                        "A vegades",
                                        "Sovint"))) %>%
  tbl_svysummary(by = "EDAT_OCUP",
                 include = c(AM73_2, AM73_3, AM73_1, AM73_4, AM73_5, AM72_1, AM75),
                 statistic = list(everything() ~ c("{n} ({p}%)")),
                 label = list(AM73_2 ~ "Hortalisses i verdures",
                              AM73_3 ~ "Fruita",
                              AM73_1 ~ "Carn vermella",
                              AM73_4 ~ "Begudes ensucrades",
                              AM73_5 ~ "Brioixeria",
                              AM72_1 ~ "Esmorzar abans de sortir de casa",
                              AM75 ~ "Reduir racions de menjar o saltar-se algun àpat per manca de diners"),
                 missing_text = "Desconegut") %>% 
  add_p() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_esb_edat_h <- as_flex_table(esb_edat_h) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Grup d'edat", "", "", "", "",
                                     "p-valor²")) %>% 
  merge_at(i = 1, j = 2:6, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 7, part = "header") %>%
  bold(i = 1:2, j = 1:7, part = "header")

flextable_esb_edat_h
```

### Per classe social {.tabset}

#### Dones

```{r esb_cs_d, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
esb_cs_d <- dadesev %>% 
  filter(SEXE==2) %>% 
  mutate(CS5PR = case_when(CS5PR== 1 ~ "I",
                           CS5PR== 2 ~ "II",
                           CS5PR== 3 ~ "III",
                           CS5PR== 4 ~ "IV",
                           CS5PR== 5 ~ "V")) %>% 
  mutate(CS5PR = factor(CS5PR, levels = c("I",
                                          "II",
                                          "III",
                                          "IV",
                                          "V"))) %>%
  mutate(AM73_2 = case_when(AM73_2== 0 ~ "Mai",
                            AM73_2== 1 ~ "3 vegades al mes o menys",
                            AM73_2== 2 ~ "3 vegades al mes o menys",
                            AM73_2== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_2== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_2 = factor(AM73_2, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_3 = case_when(AM73_3== 0 ~ "Mai",
                            AM73_3== 1 ~ "3 vegades al mes o menys",
                            AM73_3== 2 ~ "3 vegades al mes o menys",
                            AM73_3== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_3== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_3 = factor(AM73_3, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_1 = case_when(AM73_1== 0 ~ "Mai",
                            AM73_1== 1 ~ "3 vegades al mes o menys",
                            AM73_1== 2 ~ "3 vegades al mes o menys",
                            AM73_1== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_1== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_1 = factor(AM73_1, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_4 = case_when(AM73_4== 0 ~ "Mai",
                            AM73_4== 1 ~ "3 vegades al mes o menys",
                            AM73_4== 2 ~ "3 vegades al mes o menys",
                            AM73_4== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_4== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_4 = factor(AM73_4, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_5 = case_when(AM73_5== 0 ~ "Mai",
                            AM73_5== 1 ~ "3 vegades al mes o menys",
                            AM73_5== 2 ~ "3 vegades al mes o menys",
                            AM73_5== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_5== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_5 = factor(AM73_5, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM72_1 = case_when(AM72_1== 1 ~ "Mai",
                              AM72_1== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              AM72_1== 3 ~ "Entre 4 i 6 vegades a la setmana",
                              AM72_1== 4 ~ "Cada dia")) %>%
  mutate(AM72_1 = factor(AM72_1, levels = c("Mai",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Entre 4 i 6 vegades a la setmana",
                                                "Cada dia"))) %>%
  mutate(AM75 = case_when(AM75== 3 ~ "Mai",
                          AM75== 2 ~ "A vegades",
                          AM75== 1 ~ "Sovint")) %>%
  mutate(AM75 = factor(AM75, levels = c("Mai",
                                        "A vegades",
                                        "Sovint"))) %>%
  tbl_svysummary(by = "CS5PR",
                 include = c(AM73_2, AM73_3, AM73_1, AM73_4, AM73_5, AM72_1, AM75),
                 statistic = list(everything() ~ c("{n} ({p}%)")),
                 label = list(AM73_2 ~ "Hortalisses i verdures",
                              AM73_3 ~ "Fruita",
                              AM73_1 ~ "Carn vermella",
                              AM73_4 ~ "Begudes ensucrades",
                              AM73_5 ~ "Brioixeria",
                              AM72_1 ~ "Esmorzar abans de sortir de casa",
                              AM75 ~ "Reduir racions de menjar o saltar-se algun àpat per manca de diners"),
                 missing_text = "Desconegut") %>% 
  add_p() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_esb_cs_d <- as_flex_table(esb_cs_d) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Classe social³", "", "", "", "",
                                     "p-valor²")) %>% 
  merge_at(i = 1, j = 2:6, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 7, part = "header") %>%
  bold(i = 1:2, j = 1:7, part = "header") %>% 
  footnote(i = 1, j = 3, ref_symbols = c(""), value = as_paragraph("³Regidor, Enrique. La clasificación de clase social de Goldthorpe: marco de referencia para la propuesta de medición de la clase social del grupo de trabajo de la Sociedad Española de Epidemiología. Rev. Esp. Salud Publica  [Internet]. 2001  Feb [citat  2022  Maig  17]; 75(1): 00-00. Disponible en: http://scielo.isciii.es/scielo.php?script=sci_arttext&pid=S1135-57272001000100003&lng=es."))

flextable_esb_cs_d
```

#### Homes

```{r esb_cs_h, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
esb_cs_h <- dadesev %>% 
  filter(SEXE==1) %>% 
  mutate(CS5PR = case_when(CS5PR== 1 ~ "I",
                           CS5PR== 2 ~ "II",
                           CS5PR== 3 ~ "III",
                           CS5PR== 4 ~ "IV",
                           CS5PR== 5 ~ "V")) %>% 
  mutate(CS5PR = factor(CS5PR, levels = c("I",
                                          "II",
                                          "III",
                                          "IV",
                                          "V"))) %>%
  mutate(AM73_2 = case_when(AM73_2== 0 ~ "Mai",
                            AM73_2== 1 ~ "3 vegades al mes o menys",
                            AM73_2== 2 ~ "3 vegades al mes o menys",
                            AM73_2== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_2== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_2 = factor(AM73_2, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_3 = case_when(AM73_3== 0 ~ "Mai",
                            AM73_3== 1 ~ "3 vegades al mes o menys",
                            AM73_3== 2 ~ "3 vegades al mes o menys",
                            AM73_3== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_3== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_3 = factor(AM73_3, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_1 = case_when(AM73_1== 0 ~ "Mai",
                            AM73_1== 1 ~ "3 vegades al mes o menys",
                            AM73_1== 2 ~ "3 vegades al mes o menys",
                            AM73_1== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_1== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_1 = factor(AM73_1, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_4 = case_when(AM73_4== 0 ~ "Mai",
                            AM73_4== 1 ~ "3 vegades al mes o menys",
                            AM73_4== 2 ~ "3 vegades al mes o menys",
                            AM73_4== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_4== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_4 = factor(AM73_4, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_5 = case_when(AM73_5== 0 ~ "Mai",
                            AM73_5== 1 ~ "3 vegades al mes o menys",
                            AM73_5== 2 ~ "3 vegades al mes o menys",
                            AM73_5== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_5== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_5 = factor(AM73_5, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM72_1 = case_when(AM72_1== 1 ~ "Mai",
                              AM72_1== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              AM72_1== 3 ~ "Entre 4 i 6 vegades a la setmana",
                              AM72_1== 4 ~ "Cada dia")) %>%
  mutate(AM72_1 = factor(AM72_1, levels = c("Mai",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Entre 4 i 6 vegades a la setmana",
                                                "Cada dia"))) %>%
  mutate(AM75 = case_when(AM75== 3 ~ "Mai",
                          AM75== 2 ~ "A vegades",
                          AM75== 1 ~ "Sovint")) %>%
  mutate(AM75 = factor(AM75, levels = c("Mai",
                                        "A vegades",
                                        "Sovint"))) %>%
  tbl_svysummary(by = "CS5PR",
                 include = c(AM73_2, AM73_3, AM73_1, AM73_4, AM73_5, AM72_1, AM75),
                 statistic = list(everything() ~ c("{n} ({p}%)")),
                 label = list(AM73_2 ~ "Hortalisses i verdures",
                              AM73_3 ~ "Fruita",
                              AM73_1 ~ "Carn vermella",
                              AM73_4 ~ "Begudes ensucrades",
                              AM73_5 ~ "Brioixeria",
                              AM72_1 ~ "Esmorzar abans de sortir de casa",
                              AM75 ~ "Reduir racions de menjar o saltar-se algun àpat per manca de diners"),
                 missing_text = "Desconegut") %>% 
  add_p() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_esb_cs_h <- as_flex_table(esb_cs_h) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Classe social³", "", "", "", "",
                                     "p-valor²")) %>% 
  merge_at(i = 1, j = 2:6, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 7, part = "header") %>%
  bold(i = 1:2, j = 1:7, part = "header") %>% 
  footnote(i = 1, j = 3, ref_symbols = c(""), value = as_paragraph("³Regidor, Enrique. La clasificación de clase social de Goldthorpe: marco de referencia para la propuesta de medición de la clase social del grupo de trabajo de la Sociedad Española de Epidemiología. Rev. Esp. Salud Publica  [Internet]. 2001  Feb [citat  2022  Maig  17]; 75(1): 00-00. Disponible en: http://scielo.isciii.es/scielo.php?script=sci_arttext&pid=S1135-57272001000100003&lng=es."))

flextable_esb_cs_h
```

### Per lloc de naixement {.tabset}

#### Dones

```{r esb_naix_d, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
esb_naix_d <- dadesev %>% 
  filter(SEXE==2) %>% 
  mutate(PNAIX = case_when(PNAIX== 1 ~ "Catalunya",
                           PNAIX== 2 ~ "Resta de l'Estat espanyol",
                           PNAIX== 3 ~ "Altres països de renda alta",
                           PNAIX== 4 ~ "Altres països de renda baixa")) %>% 
  mutate(PNAIX = factor(PNAIX, levels = c("Catalunya",
                                          "Resta de l'Estat espanyol",
                                          "Altres països de renda alta",
                                          "Altres països de renda baixa"))) %>%
  mutate(AM73_2 = case_when(AM73_2== 0 ~ "Mai",
                            AM73_2== 1 ~ "3 vegades al mes o menys",
                            AM73_2== 2 ~ "3 vegades al mes o menys",
                            AM73_2== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_2== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_2 = factor(AM73_2, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_3 = case_when(AM73_3== 0 ~ "Mai",
                            AM73_3== 1 ~ "3 vegades al mes o menys",
                            AM73_3== 2 ~ "3 vegades al mes o menys",
                            AM73_3== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_3== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_3 = factor(AM73_3, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_1 = case_when(AM73_1== 0 ~ "Mai",
                            AM73_1== 1 ~ "3 vegades al mes o menys",
                            AM73_1== 2 ~ "3 vegades al mes o menys",
                            AM73_1== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_1== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_1 = factor(AM73_1, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_4 = case_when(AM73_4== 0 ~ "Mai",
                            AM73_4== 1 ~ "3 vegades al mes o menys",
                            AM73_4== 2 ~ "3 vegades al mes o menys",
                            AM73_4== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_4== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_4 = factor(AM73_4, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_5 = case_when(AM73_5== 0 ~ "Mai",
                            AM73_5== 1 ~ "3 vegades al mes o menys",
                            AM73_5== 2 ~ "3 vegades al mes o menys",
                            AM73_5== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_5== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_5 = factor(AM73_5, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM72_1 = case_when(AM72_1== 1 ~ "Mai",
                              AM72_1== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              AM72_1== 3 ~ "Entre 4 i 6 vegades a la setmana",
                              AM72_1== 4 ~ "Cada dia")) %>%
  mutate(AM72_1 = factor(AM72_1, levels = c("Mai",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Entre 4 i 6 vegades a la setmana",
                                                "Cada dia"))) %>%
  mutate(AM75 = case_when(AM75== 3 ~ "Mai",
                          AM75== 2 ~ "A vegades",
                          AM75== 1 ~ "Sovint")) %>%
  mutate(AM75 = factor(AM75, levels = c("Mai",
                                        "A vegades",
                                        "Sovint"))) %>%
  tbl_svysummary(by = "PNAIX",
                 include = c(AM73_2, AM73_3, AM73_1, AM73_4, AM73_5, AM72_1, AM75),
                 statistic = list(everything() ~ c("{n} ({p}%)")),
                 label = list(AM73_2 ~ "Hortalisses i verdures",
                              AM73_3 ~ "Fruita",
                              AM73_1 ~ "Carn vermella",
                              AM73_4 ~ "Begudes ensucrades",
                              AM73_5 ~ "Brioixeria",
                              AM72_1 ~ "Esmorzar abans de sortir de casa",
                              AM75 ~ "Reduir racions de menjar o saltar-se algun àpat per manca de diners"),
                 missing_text = "Desconegut") %>% 
  add_p() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_esb_naix_d <- as_flex_table(esb_naix_d) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Lloc de naixement", "", "", "",
                                     "p-valor²")) %>% 
  merge_at(i = 1, j = 2:5, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 6, part = "header") %>%
  bold(i = 1:2, j = 1:6, part = "header")

flextable_esb_naix_d
```

#### Homes

```{r esb_naix_h, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
esb_naix_h <- dadesev %>% 
  filter(SEXE==1) %>% 
  mutate(PNAIX = case_when(PNAIX== 1 ~ "Catalunya",
                           PNAIX== 2 ~ "Resta de l'Estat espanyol",
                           PNAIX== 3 ~ "Altres països de renda alta",
                           PNAIX== 4 ~ "Altres països de renda baixa")) %>% 
  mutate(PNAIX = factor(PNAIX, levels = c("Catalunya",
                                          "Resta de l'Estat espanyol",
                                          "Altres països de renda alta",
                                          "Altres països de renda baixa"))) %>%
  mutate(AM73_2 = case_when(AM73_2== 0 ~ "Mai",
                            AM73_2== 1 ~ "3 vegades al mes o menys",
                            AM73_2== 2 ~ "3 vegades al mes o menys",
                            AM73_2== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_2== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_2== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_2 = factor(AM73_2, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_3 = case_when(AM73_3== 0 ~ "Mai",
                            AM73_3== 1 ~ "3 vegades al mes o menys",
                            AM73_3== 2 ~ "3 vegades al mes o menys",
                            AM73_3== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_3== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_3== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_3 = factor(AM73_3, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_1 = case_when(AM73_1== 0 ~ "Mai",
                            AM73_1== 1 ~ "3 vegades al mes o menys",
                            AM73_1== 2 ~ "3 vegades al mes o menys",
                            AM73_1== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_1== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_1== 6 ~ "1 o més vegades al dia")) %>%
  mutate(AM73_1 = factor(AM73_1, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_4 = case_when(AM73_4== 0 ~ "Mai",
                            AM73_4== 1 ~ "3 vegades al mes o menys",
                            AM73_4== 2 ~ "3 vegades al mes o menys",
                            AM73_4== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_4== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_4== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_4 = factor(AM73_4, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM73_5 = case_when(AM73_5== 0 ~ "Mai",
                            AM73_5== 1 ~ "3 vegades al mes o menys",
                            AM73_5== 2 ~ "3 vegades al mes o menys",
                            AM73_5== 3 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 4 ~ "1 o 2 vegades a la setmana",
                            AM73_5== 5 ~ "Entre 3 i 6 vegades a la setmana",
                            AM73_5== 6 ~ "1 o més vegades al dia")) %>% 
  mutate(AM73_5 = factor(AM73_5, levels = c("Mai",
                                            "3 vegades al mes o menys",
                                            "1 o 2 vegades a la setmana",
                                            "Entre 3 i 6 vegades a la setmana",
                                            "1 o més vegades al dia"))) %>%
  mutate(AM72_1 = case_when(AM72_1== 1 ~ "Mai",
                              AM72_1== 2 ~ "Entre 1 i 3 vegades a la setmana",
                              AM72_1== 3 ~ "Entre 4 i 6 vegades a la setmana",
                              AM72_1== 4 ~ "Cada dia")) %>%
  mutate(AM72_1 = factor(AM72_1, levels = c("Mai",
                                                "Entre 1 i 3 vegades a la setmana",
                                                "Entre 4 i 6 vegades a la setmana",
                                                "Cada dia"))) %>%
  mutate(AM75 = case_when(AM75== 3 ~ "Mai",
                          AM75== 2 ~ "A vegades",
                          AM75== 1 ~ "Sovint")) %>%
  mutate(AM75 = factor(AM75, levels = c("Mai",
                                        "A vegades",
                                        "Sovint"))) %>%
  tbl_svysummary(by = "PNAIX",
                 include = c(AM73_2, AM73_3, AM73_1, AM73_4, AM73_5, AM72_1, AM75),
                 statistic = list(everything() ~ c("{n} ({p}%)")),
                 label = list(AM73_2 ~ "Hortalisses i verdures",
                              AM73_3 ~ "Fruita",
                              AM73_1 ~ "Carn vermella",
                              AM73_4 ~ "Begudes ensucrades",
                              AM73_5 ~ "Brioixeria",
                              AM72_1 ~ "Esmorzar abans de sortir de casa",
                              AM75 ~ "Reduir racions de menjar o saltar-se algun àpat per manca de diners"),
                 missing_text = "Desconegut") %>% 
  add_p() %>% 
  italicize_levels() %>% 
  bold_p() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()

flextable_esb_naix_h <- as_flex_table(esb_naix_h) %>% 
  autofit() %>% 
  add_header_row(top = T, values = c("Variable", "Lloc de naixement", "", "", "",
                                     "p-valor²")) %>% 
  merge_at(i = 1, j = 2:5, part = "header") %>% 
  merge_at(i = 1:2, j = 1, part = "header") %>% 
  merge_at(i = 1:2, j = 6, part = "header") %>%
  bold(i = 1:2, j = 1:6, part = "header")

flextable_esb_naix_h
```
